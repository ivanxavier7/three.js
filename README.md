# Three.js

* [Three.js Docs](https://threejs.org/docs/)


------


## [1 - Basic](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic)

1. [Setup](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#1---setup)
2. [Scene](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#2---scene)
3. [Cameras](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#3---cameras)

    1. [Custom camera controls](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#31---custom-camera-controls)
    2. [Built in Controls](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#31---custom-camera-controls)
    3. [Fullscreen](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#33---fullscreen)

        1. [Fullscreen example](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#331---fullscreen-example)
        2. [Handle resize and pixel ratio](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#332---handle-resize-and-pixel-ratio)
        3. [Handle fullscreen double click](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#333---handle-fullscreen-double-click)

4. [Objects](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#4---objects)

    1. [Geometry](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#41---geometry)

        1. [Simple Geometry](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#411---simple-geometry)
        2. [Custom Geometry](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#412---custom-geometry)

    2. [Texture](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#42---textures)

        1. [Types](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#421---types)
        2. [Free textures](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#422---free-textures)
        3. [Loading](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#423---loading)
        4. [Texture Loader](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#424---texture-loader)
        5. [Loading Manager](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#425---loading-manager)
        6. [Transformation](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#426---transformation)
        7. [Filtering and MIPMapping](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#427---filtering-and-mipmapping)
        8. [Optimization](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#428---optimization)

    3. [Material](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#43---materials)

        1. [Default Meshes](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#431---default-meshes)
        2. [Imported texture implementation](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#432---imported-texture-implementation)
        3. [Environment Map](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#433---environment-map)

    4. [Lights](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#44---lights)

        1. [Types of lights](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#441---types-of-lights)
        2. [Implementations](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#442---implementations)
        3. [Light Helpers](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#443---light-helpers)

    5. [Shadows](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#45---shadows)

        1. [Enable Shadows](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#451---enable-shadows)
        2. [Optimize shadows resolution](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#452---optimize-shadows-resolution)
        3. [ShadowMap Algorithms](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#453---shadowmap-algorithms)
        4. [SpotLight](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#454---spotlight)
        5. [PointLight](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#455---pointlight)
        6. [Baking Shadows](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#456---baking-shadows)

5. [Renderer - Animations](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#5---renderer)

    1. [Animating](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#51---animating)
    2. [Delta Time](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#52---delta-time)
    3. [Clock](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#53---clock)
    4. [Animating](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#54---animating)
    5. [Animating with GSAP library](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#55---animating-with-gsap-library)


### [Extras](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#6---extras)

1. [Debug UI](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#61---debug-ui)
2. [Measure time loading resources](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#62---measure-time-loading-resources)
3. [3D Text](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#63---3d-text)

    1. [Types of text](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#631----types-of-text)
    2. [Import font and facetype](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#632---import-font-and-facetype)
    3. [Implementation](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#633---implementation)

4. [Particles](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#64---particles)

    1. [Default Geometry](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#641---default-geometry)
    2. [Custom Geometry](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#642---custom-geometry)
    3. [Particles Map and AlphaMap](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#643---particles-map-and-alphamap)
    4. [Randomize colors](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#644---randomize-colors)
    5. [Animate particles](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#645---animate-particles)



------


## [2 - Advanced](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced)

1. [Physics](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#1---physics)

    1. [Libraries](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#11---libraries)
    2. [Cannon library](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#12---cannon-library)
    3. [Apply Forces](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#13---apply-forces)
    4. [Handle Multiple Objects](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#14---handle-multiple-objects)
    5. [Performance](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#15---performance)
    6. [Events](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#16---events)
    7. [Remove Objects](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#17---remove-objects)
    8. [Constraints](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#18---constraints)
    9. [Aditional Notes](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#19---aditional-notes)
    10. [Popular alternatives](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#110---popular-alternatives)

2. [Imported Models](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#2---imported-models)

    1. [Types of Models](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#21---types-of-models)
    2. [glTF Formats](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#22---gltf-formats)
    3. [Loading the Model](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#23---loading-the-model)
    4. [Animations inside the model](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#24---animations-inside-the-model)
    5. [THREE.js Online Editor](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#24---animations-inside-the-model)

3. [RayCaster and Mouse Events](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#3---raycaster-and-mouse-events)

    1. [Intersect properties](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#31---intersect-properties)
    2. [Horizontal Ray](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#32---horizontal-ray)
    3. [Mouse Events](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#33---mouse-events)

        1. [Hovering](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#331---hovering)
        2. [Clicking](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#332---clicking)

4. [Custom Models - Blender](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#4---custom-models---blender)

    1. [Layout](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#41---layout)
    2. [Scene](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#42---scene)
    3. [View](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#43---view)
    4. [Object](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#44---object)
    5. [Selection](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#45---selection)
    6. [Modes](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#46---modes)
    7. [Edition](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#47---edition)
    8. [Curves](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#48---curves)
    9. [Render](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#49---render)
    10. [Timeline](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#410---timeline)
    11. [Export model](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#411---export-model)
    12. [More Blender Youtube resources](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#412---more-blender-youtube-resources)

5. [Environment Map](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#5---environment-mapping-and-ai)

    1. [Download resources](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#51-download-resources)
    2. [Implementation](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#52---implementation)
    3. [Blur and Light](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#53---blur-and-light)
    4. [HDRI Equirectangular Environment Map](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#54---hdri-equirectangular-environment-map)
    5. [Generate HDRI](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#55---generate-hdri)
    6. [Bring object inside Environment Map closer to the ground](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#56---bring-object-inside-environment-map-closer-to-the-ground)
    7. [Real-Time Environment Map](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#57---real-time-environment-map)

6. [Realistic Render](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#6---realistic-rendering)

    1. [Tone Maping](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#61---tone-maping)
    2. [Antialiasing](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#62---antialiasing)
    3. [Add Shadow to Environment Map](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#63---add-shadow-to-environment-map)
    4. [Textures](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#64---textures)

7. [Code Structure - Object Oriented](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#7---structure-for-bigger-projects---object-oriented)

    1. [Classes and Modules](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#71----classes-and-modules)
    2. [Object Oriented Structure](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#72----object-oriented-structure)

8. [Shaders](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8---shaders)

    1. [Basics](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#81---basics)

        1. [Description](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#811---description)
        2. [Documentation](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#812---documentation)
        3. [Shader Material](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#813---shader-material)
        4. [Vertex Shader](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#814---vertex-shader)
        5. [Fragment Shader](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#815---fragment-shader)
        6. [Vertex and Fragment Shader](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#816---vertex-and-fragment-shader)
        7. [ShaderMaterial](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#817---shadermaterial)
        8. [More information about Shaders](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#818---more-information-about-shaders)
        9. [Implementation](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#819---implementation)

    2. [Shader Patterns](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#82---shader-patterns)

        1. [Normal pattern](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#821---normal-pattern)
        2. [Normal pattern alternative](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#822---normal-pattern-alternative)
        3. [Simple Grey gradient](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#823---simple-grey-gradient)
        4. [Rotated Grey gradient](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#824---rotated-grey-gradient)
        5. [Inverted Grey gradient](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#825---inverted-grey-gradient)
        6. [Grey gradient but with more white](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#826---grey-gradient-but-with-more-white)
        7. [Grey gradient repeating like roof tiles](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#827---grey-gradient-repeating-like-roof-tiles)
        8. [Grey gradient repeating like roof tiles but more black space between tiles](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#828---grey-gradient-repeating-like-roof-tiles-but-more-black-space-between-tiles)
        9. [Grey gradient repeating like roof tiles but more black space between tiles than pattern 8](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#829---grey-gradient-repeating-like-roof-tiles-but-more-black-space-between-tiles-than-pattern-8)
        10. [Rotate last pattern](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8210---rotate-last-pattern)
        11. [Patern 9 and 10 added together to make multiple squares](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8211---patern-9-and-10-added-together-to-make-multiple-squares)
        12. [Inverted 11 pattern, dots](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8212---inverted-11-pattern-dots)
        13. [Make the dots rectangles](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8213---make-the-dots-rectangles)
        14. [Mix with 13 and 13 in other axis](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8214---mix-with-13-and-13-in-other-axis)
        15. [Cross pattern with previous bars](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8215---cross-pattern-with-previous-bars)
        16. [Double vertical grey gradient](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8216---double-vertical-grey-gradient)
        17. [4 Gradients in square with cross in the middle](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8217---4-gradients-in-square-with-cross-in-the-middle)
        18. [4 Gradients in triangles making a X](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8218---4-gradients-in-triangles-making-a-x)
        19. [Square with empty square inside](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8219---square-with-empty-square-inside)
        20. [Square with bigger empty square inside](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8220---square-with-bigger-empty-square-inside)
        21. [Color palette of 10 grey colors](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8221---color-palette-of-10-grey-colors)
        22. [Color palette of 10*10 grey colors](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8222---color-palette-of-1010-grey-colors)
        23. [Old tv pixels without channel using Random function](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8223---old-tv-pixels-without-channel-using-random-function)
        24. [Old tv pixels with bigger pixel size, sent the vec2 to random](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8224---old-tv-pixels-with-bigger-pixel-size-sent-the-vec2-to-random)
        25. [Old tv pixels with bigger pixel size offset (rotated and stretched)](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8225---old-tv-pixels-with-bigger-pixel-size-offset-rotated-and-stretched)
        26. [Corner gradient](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8226---corner-gradient)
        27. [Center gradient](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8227---center-gradient)
        28. [Center gradient but white in the center](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8228---center-gradient-but-white-in-the-center)
        29. [Center gradient but small white like a sun](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8229---center-gradient-but-small-white-like-a-sun)
        30. [Same as 29 but stretch, elipse sun](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8230---same-as-30-but-stretch-elipse-sun)
        31. [Star](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8231---star)
        32. [Rotated Star using function](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8232---rotated-star-using-function)
        33. [Square empty circle in the middle](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8233---square-empty-circle-in-the-middle)
        34. [Eclipse with gradient inside and outside](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8234---eclipse-with-gradient-inside-and-outside)
        35. [Empty Circle](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8235---empty-circle)
        36. [Circle](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8236---circle)
        37. [Elastic (Circle with waves)](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8237---elastic-circle-with-waves)
        38. [Elastic with X (makes some particles)](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8238---elastic-with-x-makes-some-particles)
        39. [Complex, like a CPU connector](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8239---complex-like-a-cpu-connector)
        40. [Complex, like a CPU connector](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8240---complex-like-a-cpu-connector)
        41. [45 % angle gradient](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8241---45--angle-gradient)
        42. [45% angle gradient and screen cuted in the middle](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8242---45-angle-gradient-and-screen-cuted-in-the-middle)
        43. [45% gradient like a clock](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8243---45-gradient-like-a-clock)
        44. [Illusion with 20 triangles](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8244---illusion-with-20-triangles)
        45. [Illusion with 20 triangles and bigger dark space](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8245---illusion-with-20-triangles)
        46. [Waving circle](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8246---waving-circle)
        47. [Perlin Noise - Clouds, Water, Fire, Terrain, Elevation and to animate Grass and Snow (Nature Algorithm)](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8247---perlin-noise---clouds-water-fire-terrain-elevation-and)
        48. [Camouflage](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8247---perlin-noise---clouds-water-fire-terrain-elevation-and)
        49. [Neon Camouflage](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8249---neon-camouflage)
        50. [Celular ( random elastic Circles inside circles)](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8250---celular--random-elastic-circles-inside-circles)
        51. [Color application in the Pattern](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8251---color-application-in-the-pattern)

    3. [Modified Materials](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#83---modified-materials)

9. [Post-processing](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#9---post-processing)

10. [Performance](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#10---performance)

    1. [Stats](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#101---stats)
    2. [Monitor Draws](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#102---monitor-drawns)
    3. [Performance Tips](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#103---performance-tips)

        1. [Geometry](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#1031---geometry)
        2. [Light](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#1032---light)
        3. [Shadow](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#1033---shadow)
        4. [Texture](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#1034---texture)
        5. [Material](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#1035---material)
        6. [Mesh](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#1036---mesh)
        7. [Model](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#1037---model)
        8. [Camera](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#1038---camera)
        9. [Renderer](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#1039---renderer)
        10. [Post-processing](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#10310---post-processing)
        11. [Shader](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#10311---shader)

    4. [Loading and Intro](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#104---loading-and-intro)

        1. [Lower the download speed](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#1041---lower-the-download-speed)
        2. [Implementation](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#1042---implementation)

    5. [HTML and WebGL](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#105-html-and-webgl)

11. [UV unwrapping](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#11---uv-unwrapping)

    1. [Wrap](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#111---wrap)
    2. [Export](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#112---export)


------


## [3 - Projects](https://github.com/ivanxavier7/three.js/tree/main/03%20-%20Projects)

1. [Simple House](https://github.com/ivanxavier7/three.js/tree/main/03%20-%20Projects/01%20-%20Simple%20House)
2. [Particles Galaxy](https://github.com/ivanxavier7/three.js/tree/main/03%20-%20Projects/02%20-%20Particles%20Galaxy)
3. [Scroll and Cursor Animation](https://github.com/ivanxavier7/three.js/tree/main/03%20-%20Projects/03%20-%20Scroll%20and%20Cursor%20Animation)
4. [Sea Particles - Shader](https://github.com/ivanxavier7/three.js/tree/main/03%20-%20Projects/03%20-%20Scroll%20and%20Cursor%20Animation)
5. [Animated Galaxy - Shader](https://github.com/ivanxavier7/three.js/tree/main/03%20-%20Projects/05%20-%20Animated%20Galaxy%20%20-%20Shader)
6. [Portal - Blender - Shader](https://github.com/ivanxavier7/three.js/tree/main/03%20-%20Projects/06%20-%20Portal%20-%20Blender%20-%20Shader)


------

#  Basic

* [Three.js Docs](https://threejs.org/docs/)

1. [Setup](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#1---setup)
2. [Scene](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#2---scene)
3. [Cameras](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#3---cameras)
4. [Objects](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#4---objects)
5. [Renderer - Animations](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#5---renderer)
6. [Extras](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#6---extras)

### Extras

1. [Debug UI](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#61---debug-ui)
2. [Measure time loading resources](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#62---measure-time-loading-resources)
3. [3D Text](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#63---3d-text)
4. [Particles](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#64---particles)

------

# 1 - Setup

1. Setup project with `Vite`
2. Download [Node.js](https://nodejs.org/en/download/).
3. Run this followed commands:

``` bash
# Install dependencies (only the first time)
npm install

# Run the local server at localhost:8080
npm run dev

# Build for production in the dist/ directory
npm run build
```

------

# 2 - Scene

* Like a container
* To put objects, models, lights, etc. in it
* At some point we ask Three.js to render that scene

``` javascript
// Scene
const scene = new THREE.Scene();


// Red Cube
const geometry = new THREE.BoxGeometry(1, 1, 1);
const material = new THREE.MeshBasicMaterial({ color: 0xff0000});
const mesh = new THREE.Mesh(geometry, material);
scene.add( mesh );

// Sizes
const sizes = {
    width: 800,
    height: 600
};

// Camera
const camera = new THREE.PerspectiveCamera(75, sizes.width / sizes.height);
scene.add(camera);
camera.position.z = 3;
camera.position.x = 1;
camera.position.y = 1;

// Canvas
const canvas = document.querySelector('.webgl');

// Renderer
const renderer = new THREE.WebGLRenderer({
    canvas: canvas
});
renderer.setSize(sizes.width, sizes.height);
renderer.render(scene, camera);
```
------

# 3 - Cameras

1. [Custom camera controls](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#31---custom-camera-controls)
2. [Built in Controls](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#31---custom-camera-controls)
3. [Fullscreen](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#33---fullscreen)

* Not visible without helpers
* Serve as point of view when doing a render
* Can have multiple and switch between them
* Different types
* Field of View (FOV) in Degrees
* Aspect Ratio (screen resolution)

## 3.1 - Custom camera controls

``` javascript

/**
 * Custom Camera Cursor
 */
const cursor = {
    x: 0,
    y: 0,
}
window.addEventListener('mousemove', (event) => {
    cursor.x = event.clientX / sizes.width - 0.5
    cursor.y = -(event.clientY / sizes.height - 0.5)
    console.log(cursor)
})


// Camera

const camera = new THREE.PerspectiveCamera(75, sizes.width / sizes.height, 0.1, 100)

//const aspectRatio = sizes.width / sizes.height
//const camera = new THREE.OrthographicCamera(-aspectRatio, aspectRatio, aspectRatio, -aspectRatio, 0.1, 100) // Resolution of screen is the reference of aspect ratio


// Animate

// Animate

const tick = () =>
{
    // Update camera
    camera.position.x = Math.sin(cursor.x * 2) * 2 
    camera.position.z = Math.cos(cursor.x * 2) * 2
    camera.position.y = cursor.y * 3
    camera.lookAt(mesh.position)

    // Render
    renderer.render(scene, camera)

    // Call tick again on the next frame
    window.requestAnimationFrame(tick)
}

tick()
```

## 3.2 - Built in Controls

* DeviceOrientationControls (Android)
* FlyControls
* OrbitControls
* FirstPersonControls
* PointerLockControls

[OrbitControls Documentation](https://threejs.org/docs/#examples/en/controls/OrbitControls)

``` javascript
import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
// Controls - Orbit Controls
const controls = new OrbitControls(camera, canvas)

// accelerating camera
controls.enableDamping = true

const tick = () =>
{

    controls.update()

    // Render
    renderer.render(scene, camera)

    // Call tick again on the next frame
    window.requestAnimationFrame(tick)
}

tick()
```

------

## 3.3 - Fullscreen

1. [Fullscreen example](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#331---fullscreen-example)
2. [Handle `resize` and `pixel ratio`](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#332---handle-resize-and-pixel-ratio)
3. [Handle `fullscreen` double click](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#333---handle-fullscreen-double-click)

### 3.3.1 - Fullscreen example

Full screen application in the scene.

``` javascript
const sizes = {
    width: window.innerWidth,
    height: window.innerHeight
}

/**
 * Camera
 */
// Base camera
const camera = new THREE.PerspectiveCamera(75, sizes.width / sizes.height, 0.1, 100)
```

``` css
html,
body {
    overflow: hidden;
}

canvas.webgl {
    position: fixed;;
    top: 0;
    left: 0;
    outline: none;
}
```
### 3.3.2 - Handle `resize` and `pixel ratio`

Handle readjustment of browser window size and screen pixel density

``` javascript
/**
 * Sizes
 */
const sizes = {
    width: window.innerWidth,
    height: window.innerHeight
}

window.addEventListener('resize', () => {
    sizes.width = window.innerWidth
    sizes.height = window.innerHeight

    camera.aspect = sizes. width / sizes. height
    camera.updateProjectionMatrix()

    renderer.setSize(sizes.width, sizes.height)

    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2))
})

```

### 3.3.3 - Handle `fullscreen` double click

When we click twice, it goes into fullscreen mode, with support for the Safari browser.

``` javascript
// Fullscreen with safari support
window.addEventListener('dblclick', () => {
    const fullscreenElement = document.fullscreenElement || document.webkitFullscreenElement

    if (!fullscreenElement) {
        if(canvas.requestFullscreen) {
            canvas.requestFullscreen()
        } else if (canvas.webkitRequestFullscreen) {
            canvas.webkitRequestFullscreen()
        }
    } else {
        if(document.exitFullscreen) {
            document.exitFullscreen()
        } else if (document.webkitExitFullscreen) {
            document.webkitExitFullscreen()
        }
    }
})
```

------

# 4 - Objects

To define an object we must take into account the following properties

1. [Geometry](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#41---geometry)
2. [Texture](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#42---textures)
3. [Material](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#43---materials)
4. [Lights](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#44---lights)
5. [Shadows](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#45---shadows)


------

## 4.1 - Geometry

1. [Simple Geometry](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#411---simple-geometry)
2. [Custom Geometry](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#412---custom-geometry)

Geometry is defined by the following properties

* width
* height
* depth
* widthSegments
* heightSegments
* depthSegments


### 4.1.1 - Simple Geometry

``` javascript
const geometry = new THREE.BoxGeometry(1, 1, 1, 2, 2, 2)
const material = new THREE.MeshBasicMaterial({
    color: 0xff0000,
    wireframe: true     // to see the segments
})
```

### 4.1.2 - Custom Geometry

``` javascript

// Custom Geometry
const positions = new Float32Array(9)

// First vertice
positions[0] = 0
positions[1] = 0
positions[2] = 0

// Second vertice
positions[3] = 0
positions[4] = 1
positions[5] = 0

// Third vertice
positions[6] = 1
positions[7] = 0
positions[8] = 0

// or

const positionsArray = new Float32Array( [
    0, 0, 0,    // first vertex
    0, 1, 0,    // second vertex
    1, 0, 0,    // third vertex
])

const positionsAttribute = new THREE.BufferAttribute( positionsArray, 3)

const customGeometry = new THREE.BufferGeometry()
customGeometry.setAttribute('position', positionsAttribute)
const mesh2 = new THREE.Mesh( customGeometry, new THREE.MeshBasicMaterial({
    color: 0x00ff00,
    wireframe: true
}))
scene.add(mesh2)

```

------

## 4.2 - Textures

1. [Types](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#421---types)
2. [Free textures](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#422---free-textures)
3. [Loading](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#423---loading)
4. [Texture Loader](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#424---texture-loader)
5. [Loading Manager](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#425---loading-manager)
6. [Transformation](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#426---transformation)
7. [Filtering and MIPMapping](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#427---filtering-and-mipmapping)
8. [Optimization](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#428---optimization)

### 4.2.1 - Types

Textures are defined by the following properties
* Color or Albedo
* Alpha
* Height
* Normal
* Ambient occlusion
* Metalness
* Roughness

`Color`

The albedo texture is the most simple one. It'll only take the pixels of the texture and apply them to the geometry.

`Alpha`

The alpha texture is a grayscale image where white will be visible, and black won't.

`Height`

The height texture is a grayscale image that will move the vertices to create some relief. You'll need to add subdivision if you want to see it.

`Normal`

The normal texture will add small details. It won't move the vertices, but it will lure the light into thinking that the face is oriented differently.

`Ambient occlusion`

The ambient occlusion texture is a grayscale image that will fake shadow in the surface's crevices. While it's not physically accurate, it certainly helps to create contrast.

`Metalness`

The metalness texture is a grayscale image that will specify which part is metallic (white) and non-metallic (black). This information will help to create reflection.

`Roughness`

The roughness is a grayscale image that comes with metalness, and that will specify which part is rough (white) and which part is smooth (black). This information will help to dissipate the light.


### 4.2.2 - Free textures

* [Polligon](https://www.poliigon.com/search/free?type=textures)
* [3D Textures](https://3dtextures.me/)
* [Arroway Textures](https://www.arroway-textures.ch/textures/)
* [Textures](https://www.textures.com/free)
* [FreeStockTextures](https://freestocktextures.com/texture/)
* [TextureLabs](https://texturelabs.org/)

You can use photoshop or something similar to edit or create textures

Texture used in the example

[3D Door Texture](https://3dtextures.me/2019/04/16/door-wood-001/)


### 4.2.3 - Loading

Put the `image` in the `/static/` folder

``` javascript
/**
 * Texture
 */
const image = new Image()
const texture = new THREE.Texture(image)

image.addEventListener('load', () => {
    texture.needsUpdate = true
    console.log('Image loaded successfully!')
})

image.src = '/textures/door/color.jpg'

// Instead of using color:
const material = new THREE.MeshBasicMaterial({ color: 0xff0000 })

// Change to map
const material = new THREE.MeshBasicMaterial({ map: texture })

```

### 4.2.4 - Texture Loader

`TextureLoader`

You should use this for loading textures

``` javascript
/**
 * Texture
 */
const textureLoader = new THREE.TextureLoader()
const texture = textureLoader.load('/textures/door/color.jpg')

// maping the texture in the material
const material = new THREE.MeshBasicMaterial({ map: texture })
```

### 4.2.5 - Loading Manager

`LoadingManager`

Should be used when loading multiple textures and inform when everything is loaded

``` javascript

/**
 * Texture
 */
const loadingManager = new THREE.LoadingManager()

loadingManager.onStart = () => {
    console.log('Loading started')
}
loadingManager.onProgress = () => {
    console.log('Loading object')
}
loadingManager.onLoad = () => {
    console.log('Loading finished')
}
loadingManager.onError = () => {
    console.log('Error loading objects')
}

const textureLoader = new THREE.TextureLoader(loadingManager)
const colorTexture = textureLoader.load('/textures/door/checkerboard-1024x1024.jpg')
const alphaTexture = textureLoader.load('/textures/door/alpha.jpg')
const heightTexture = textureLoader.load('/textures/door/height.jpg')
const normalTexture = textureLoader.load('/textures/door/normal.jpg')
const ambientOcclusionTexture = textureLoader.load('/textures/door/ambientOcclusion.jpg')
const metalnessTexture = textureLoader.load('/textures/door/metalness.jpg')
const roughnessTexture = textureLoader.load('/textures/door/roughness.jpg')
```

### 4.2.6 - Transformation

How the texture is wrapped around the object, uses UV coordinates

``` javascript
const textureLoader = new THREE.TextureLoader(loadingManager)
//...

//Repeat texture
//colorTexture.repeat.x = 2
//colorTexture.repeat.y = 3
//colorTexture.wrapS = THREE.RepeatWrapping   // Let the texture repeat, without stretching the last pixels
//colorTexture.wrapT = THREE.MirroredRepeatWrapping

// Padding the texture
//colorTexture.offset.x = 0.1

// Rotate texture in the specified uv point
colorTexture.rotation = Math.PI * 0.25
colorTexture.center.x = 0.5
colorTexture.center.y = 0.5
```

### 4.2.7 - Filtering and MIPMapping

how the texture is processed near or far, for example a low pixel texture may be blurred with the wrong filter

* THREE.NearestFilter
* THREE.LinearFilter
* THREE.NearestMipmapNearestFilter
* THREE.NearestMipmapLinearFilter
* THREE.LinearMipmapNearestFilter
* THREE.LinearMipmapLinearFilter

``` javascript
const textureLoader = new THREE.TextureLoader(loadingManager)
const colorTexture = textureLoader.load('/textures/minecraft.png')

// Change the object when it is far away
colorTexture.minFilter = THREE.LinearFilter

// MIPMaping is when you map smaller versions of the texture, we dont need in the THREE.NearestFilter, that's why we have to use resolutions multiples of 2^x, 8*8, 1024*1024...
colorTexture.generateMipmaps = false

// Change the object when it is close
// colorTexture.magFilter = THREE.LinearFilter // Default
colorTexture.magFilter = THREE.NearestFilter   // Best for performance
```

### 4.2.8 - Optimization

* The weight
* The resolution
* The data type

`.jpg` - Lossy compression but usually lighter

`.png` - Lossless compression but usually heavier

[Compression Website - TinyPNG](https://tinypng.com/)

------

## 4.3 - Materials

1. [Default Meshes](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#431---default-meshes)
2. [Imported texture implementation](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#432---imported-texture-implementation)
3. [Environment Map](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#433---environment-map)

To implement a material in a certain texture we must take into account the following properties

* Color
* Alpha
* AmbientOcclusion
* Height
* Normal
* Metalness
* Roughness

## 4.3.1 - Default Meshes

Algorithm that processes the pixels in a certain object to render, we will use some standard meshes

* MeshBasicMaterial
* MeshNormalMaterial
* MeshMatcapMaterial
* MeshDepthMaterial
* MeshLambertMaterial
* MeshPhongMaterial
* MeshToonMaterial
* MeshStandardMaterial  // Most used
* [MeshPhysicalMaterial](https://threejs.org/docs/index.html?q=physica#api/en/materials/MeshPhysicalMaterial)

[Matcaps Textures](https://github.com/nidorx/matcaps/tree/master)

## 4.3.2 - Imported texture implementation

``` javascript
/**
 * Textures
 */
const textureLoader = new THREE.TextureLoader()
const doorColorTexture = textureLoader.load('/textures/door/color.jpg')
const doorAlphaTexture = textureLoader.load('/textures/door/alpha.jpg')
const doorHeightTexture = textureLoader.load('/textures/door/height.jpg')
const doorNormalTexture = textureLoader.load('/textures/door/normal.jpg')
const doorAmbientOcclusionTexture = textureLoader.load('/textures/door/ambientOcclusion.jpg')
const doorMetalnessTexture = textureLoader.load('/textures/door/metalness.jpg')
const doorRoughnessTexture = textureLoader.load('/textures/door/roughness.jpg')
const doorMatcapTexture = textureLoader.load('/textures/matcaps/10.jpg')
const gradientTexture = textureLoader.load('/textures/gradients/3.jpg')

/**
 * Objects
 */
//const material = new THREE.MeshBasicMaterial({})
//material.map = doorColorTexture
//material.wireframe = true
//material.transparent = true
//material.opacity = 0.5                    // need's transparent enabled
//material.alphaMap = doorAlphaTexture      // need's transparent enabled
//material.side = THREE.DoubleSide          // To see in both sides of the plane

//const material = new THREE.MeshNormalMaterial()
//material.flatShading = true                 // Enable flat surfaces between vertices

//const material = new THREE.MeshMatcapMaterial() // Can be edited in photoshop, uses reference picture, illusion that the objects are being illuminated
//material.matcap = doorMatcapTexture

//const material = new THREE.MeshDepthMaterial()  // Dont uses lights for reflection

//const material = new THREE.MeshLambertMaterial() // Uses lights for reflection, good performance, bad lines beetween colors

//const material = new THREE.MeshPhongMaterial()  //// Uses lights for reflection, medium performance, good lines beetween colors, can adjust the shininess
//material.shininess = 100
//material.specular = new THREE.Color(0x00ff00)  // Shine color

//const material = new THREE.MeshToonMaterial() // Cartoon mesh
//material.gradientMap = gradientTexture
//gradientTexture.minFilter = THREE.NearestFilter // Gradient picture is small, and minFilter and magFilter are smothing the differences
//gradientTexture.magFilter = THREE.NearestFilter
//gradientTexture.generateMipmaps = false

const material = new THREE.MeshStandardMaterial()   // supports roughness and metalness
material.map = doorColorTexture
material.aoMap = doorAmbientOcclusionTexture
material.aoMapIntensity = 0.5
material.displacementMap = doorHeightTexture
material.displacementScale = 0.05
material.metalnessMap = doorMetalnessTexture
material.roughnessMap = doorRoughnessTexture
material.metalness = 0  // default values, others will change the map texture
material.roughness = 1  // default values, others will change the map texture
material.normalMap = doorNormalTexture
material.normalScale.set(0.5, 0.5)
material.transparent = true
material.alphaMap = doorAlphaTexture


const gui = new GUI();
gui.add(material, 'metalness').min(0).max(1).step(0.0001)
gui.add(material, 'roughness').min(0).max(1).step(0.0001)
gui.add(material, 'aoMapIntensity').min(0).max(1).step(0.0001)
gui.add(material, 'displacementScale').min(0).max(1).step(0.0001)

const sphere = new THREE.Mesh(
    new THREE.SphereGeometry(0.5, 64, 64),
    material
)

sphere.position.x = -1.5

const plane = new THREE.Mesh(
    new THREE.PlaneGeometry(1, 1, 100, 100),
    material
)

const torus = new THREE.Mesh(
    new THREE.TorusGeometry(0.3, 0.2, 64, 128),
    material
)

torus.position.x = 1.5

scene.add(sphere, plane, torus)

/**
 * Lights
 */
const ambientLight = new THREE.AmbientLight(0xffffff, 0.3)
scene.add(ambientLight)

const pointLight = new THREE.PointLight(0xffffff, 0.9)
pointLight.position.set(2, 3, 4)
scene.add(pointLight)
```

### 4.3.3 - Environment Map

Image of the surroundings of the scene, allows you to create realistic reflections on objects

[Environment Map](https://hdri-haven.com/)

[Convert Photo to CubeMap](https://matheowis.github.io/HDRI-to-CubeMap/)

------

## 4.4 - Lights

[Lights Docs](https://threejs.org/docs/?q=light#api/en/lights/AmbientLight)

1. [Types of lights](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#441---types-of-lights)
2. [Implementations](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#442---implementations)
3. [Light Helpers](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#443---light-helpers)

Lights cost a lot in performance, try to add as few lights as possible, and chose the most efficient ones

### 4.4.1 - Types of lights

* AmbientLight      Minimal
* HemisphereLight   Minimal
* DirectionalLight  Moderate
* PointLight        Moderate
* SpotLight         High
* RectAreaLight     High


### 4.4.2 - Implementations

``` javascript
/**
 * Lights
 */

// Irrealistic, light's everything
//const ambientLight = new THREE.AmbientLight(0xffffff, 0.5)
//scene.add(ambientLight)

// Light from one side
//const directionalLight = new THREE.DirectionalLight(0x00ffff, 0.3)
//directionalLight.position.set(1, 0.25, 0)
//scene.add(directionalLight)

// Light from one side and different color from the ground
//const hemisphereLight = new THREE.HemisphereLight(0xff0000, 0x0000ff, 0.3)
//scene.add(hemisphereLight)

// Point Light
//const pointLight = new THREE.PointLight(0x00ff00, 0.5, 10, 2)
//pointLight.position.set(-1, 0.25, 0)
//scene.add(pointLight)

// Rectangle Light
//const rectAreaLight = new THREE.RectAreaLight(0x4e00ff, 2, 5, 1)
//rectAreaLight.position.set(-1.5, 0, 1.5)
//rectAreaLight.lookAt(new THREE.Vector3())
//scene.add(rectAreaLight)

// SpotLight - FlashLight
const spotLight = new THREE.SpotLight(0x11AA55, 0.5, 10, Math.PI * 0.1, 0.25, 1)
spotLight.position.set(0, 2, 3)
spotLight.target.position.x = -0.75

scene.add(spotLight.target, spotLight)
```

### 4.4.3 - Light Helpers

Assit us positioning the lights

``` javascript
import { RectAreaLightHelper } from 'three/examples/jsm/helpers/RectAreaLightHelper.js'

/**
 * Light Helpers
 */
const hemisphereLightHelper = new THREE.HemisphereLightHelper(hemisphereLight, 0.2)

const directionalLightHelper = new THREE.DirectionalLightHelper(directionalLight, 0.2)

const pointLightHelper = new THREE.PointLightHelper(pointLight, 0.2)

const rectAreaLightHelper = new RectAreaLightHelper(rectAreaLight)

scene.add(hemisphereLightHelper, directionalLightHelper, pointLightHelper, rectAreaLightHelper)
```

------

## 4.5 - Shadows

1. [Enable Shadows](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#451---enable-shadows)
2. [Optimize shadows resolution](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#452---optimize-shadows-resolution)
3. [ShadowMap Algorithms](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#453---shadowmap-algorithms)
4. [SpotLight](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#454---spotlight)
5. [PointLight](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#455---pointlight)
6. [Baking Shadows](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#456---baking-shadows)


### 4.5.1 - Enable Shadows
``` javascript
// Enable shadows with this light
directionalLight.castShadow = true

// CastShadow
sphere.castShadow = true

// Receive shadow
plane.receiveShadow = true

// Enable shadows on the renderer
renderer.shadowMap.enabled = true
```

### 4.5.2 - Optimize shadows resolution

``` javascript
// Enable shadows with this light
directionalLight.castShadow = true

// Optimize shadow map, default is 512x512
directionalLight.shadow.mapSize.width = 1024
directionalLight.shadow.mapSize.height = 1024
directionalLight.shadow.camera.near = 1
directionalLight.shadow.camera.far = 6

// Move Shadow
directionalLight.shadow.camera.top = 2
directionalLight.shadow.camera.right = 2
directionalLight.shadow.camera.bottom = -2
directionalLight.shadow.camera.left = -2

// Blur Shadow
//directionalLight.shadow.radius = 10

scene.add(directionalLight)
```

### 4.5.3 - ShadowMap Algorithms

Algorithms in order of increasing performance and decreasing quality:
* BasicShadowMaps
* PCFShadowMap
* PCFSoftShadowMap
* VSMShadowMap

``` javascript
renderer.shadowMap.type = THREE.PCFSoftShadowMap
```

### 4.5.4 - SpotLight

``` javascript
// SpotLight
const spotLight = new THREE.SpotLight(0xffffff, 0.4, 10, Math.PI * 0.3)

spotLight.castShadow = true
spotLight.position.set(0, 2, 3)

spotLight.shadow.mapSize.width = 1024
spotLight.shadow.mapSize.height = 1024
spotLight.shadow.camera.near = 1
spotLight.shadow.camera.far = 6

spotLight.shadow.camera.fov = 30

scene.add(spotLight, spotLight.target)
```

### 4.5.5 - PointLight

``` javascript
// PointLight
const pointLight = new THREE.PointLight(0xffffff, 0.3)

pointLight.castShadow = true

pointLight.position.set(-1, 1, 0)

pointLight.shadow.mapSize.width = 1024
pointLight.shadow.mapSize.height = 1024
pointLight.shadow.camera.near = 0.1
pointLight.shadow.camera.far = 5

scene.add(pointLight)
```

### 4.5.6 - Baking Shadows

Better performance, can't move the shadows or lights

``` javascript
renderer.shadowMap.enabled = false
directionalLight.castShadow = false
spotLight.castShadow = false
pointLight.castShadow = false

/**
 * Textures
 *
 */
const textureLoader = new THREE.TextureLoader()
const bakedShadow = textureLoader.load('/textures/bakedShadow.jpg')

// On the receiving
const plane = new THREE.Mesh(
    new THREE.PlaneGeometry(5, 5),
    new THREE.MeshBasicMaterial({
        map: bakedShadow
    })
)
```

------

# 5 - Renderer - Animations

1. [Animating](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#51---animating)
2. [Delta Time](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#52---delta-time)
3. [Clock](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#53---clock)
4. [Animating](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#54---animating)
5. [Animating with GSAP library](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#55---animating-with-gsap-library)

Display the scene onto a HTML canvas

* Render from POV
* Result draw into a canvas
* Canvas is a HTML element in witch you can draw stuff
* Three.js use WebGL to draw inside the canvas

## 5.1 - Animating

`requestAnimationFrame` calls a function in the next frame

``` javascript

const tick = () => {
    mesh.position.x -= 0.005
    mesh.position.y += 0.002

    renderer.render(scene, camera)

    window.requestAnimationFrame(tick)
}

tick()

```

## 5.2 - Delta Time

To sync frames in any device we need time difference implementation, `deltaTime`.

``` javascript

//Time
let time = Date.now()

// Animation
const tick = () => {

    const currentTime = Date.now()
    const deltaTime = currentTime - time
    time = currentTime

    mesh.rotation.x -= 0.0005 * deltaTime
    mesh.position.y += 0.00005 * deltaTime

    renderer.render(scene, camera)

    window.requestAnimationFrame(tick)
}

tick()

```

## 5.3 - Clock

The best way to implement time difference is using `Clock` class, we get per second interaction

``` javascript

//Time
let clock = new THREE.Clock()

// Animation
const tick = () => {

    // Clock
    const elapsedTime = clock.getElapsedTime()

    mesh.rotation.x -= 0.0005 * elapsedTime
    mesh.position.y += 0.00005 * elapsedTime

    renderer.render(scene, camera)

    window.requestAnimationFrame(tick)
}

tick()

```

## 5.4 - Animating

Animation suggestions for looping

``` javascript

    mesh.position.y = Math.sin(elapsedTime)
    mesh.position.x = Math.cos(elapsedTime)
    mesh.rotation.x += 0.0005 * Math.cos(elapsedTime)

    camera.lookAt(mesh.position)

```

## 5.5 - Animating with GSAP library

For simpler animation controll, use `GSAP library`:

Install inside `client/frontend`, this moves the object 2 units in 1 second after 1 second delay

``` bash
npm install --save gsap@3.5.1
```
``` javascript
import gsap from 'gsap'

gsap.to(mesh.position, { duration: 1, delay:1, x: 2 })

// Animation
const tick = () => {
    renderer.render(scene, camera)

    window.requestAnimationFrame(tick)
}

tick()

```

------

# 6 - Extras

1. [Debug UI](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#61---debug-ui)
2. [Measure time loading resources](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#62---measure-time-loading-resources)
3. [3D Text](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#63---3d-text)
4. [Particles](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#64---particles)

## 6.1 - Debug UI

GUI configuration to help change values.

* [lil-gui](https://github.com/georgealways/lil-gui)
* [npm lil-gui install](https://www.npmjs.com/package/lil-gui)

``` bash
npm install --save lil-gui
```

``` javascript
import GUI from 'lil-gui';

/**
 * Debug gui
 */
const gui = new GUI();

// Position
gui.add(mesh.position, 'x')
    .min(-3)
    .max(3)
    .step(0.01)
    .name('X Position')

gui.add(mesh.position, 'y')
    .min(-3)
    .max(3)
    .step(0.01)
    .name('Y Position')

gui.add(mesh.position, 'z')
    .min(-3)
    .max(3)
    .step(0.01)
    .name('Z Position')

// Rotation
gui.add(mesh.rotation, 'x')
    .min(-3)
    .max(3)
    .step(0.01)
    .name('X Rotation')

gui.add(mesh.rotation, 'y')
    .min(-3)
    .max(3)
    .step(0.01)
    .name('Y Rotation')

gui.add(mesh.rotation, 'z')
    .min(-3)
    .max(3)
    .step(0.01)
    .name('Z Rotation')

// Booleans / Flags
gui.add(mesh, 'visible')
    .name('Show Mesh')
gui.add(material, 'wireframe')
    .name('Enable Wireframe')

//Colors
gui.addColor(material, 'color')
    .name('Color')

const functions = {
    spinX: () => {
        gsap.to(mesh.rotation, { duration: 1, y: mesh.rotation.x + Math.PI * 2})
    },
    spinY: () => {
        gsap.to(mesh.rotation, { duration: 1, y: mesh.rotation.y + Math.PI * 2})
    },
}

// Function Execution / Unitary Test
gui.add(functions, 'spinX')
gui.add(functions, 'spinY')
```

------

## 6.2 - Measure Time loading resources

`console.time()`

`console.timeEnd()`

```javascript
// Monitor time to load something
console.time('donuts')

// 100 random Donuts
const donutGeometry = new THREE.TorusGeometry(0.3, 0.2, 20, 45)

for(let i=0; i<200; i++) {
    const donut = new THREE.Mesh(donutGeometry, material)

    donut.position.set(
        1 + (Math.random() - 0.5) * 10,
        1 +(Math.random() - 0.5) * 10,
        1 + (Math.random() - 0.5) * 10,
    )

    donut.rotation.x = Math.random() * Math.PI
    donut.rotation.y = Math.random() * Math.PI

    const scale = Math.random()
    donut.scale.set(scale, scale, scale)

    scene.add(donut)
}
console.timeEnd('donuts')
```

------

## 6.3 - 3D Text

1. [Types of text](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#631----types-of-text)
2. [Import font and facetype](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#632---import-font-and-facetype)
3. [Implementation](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#633---implementation)

`TextGeometry`
[TextGeometry Docs](https://threejs.org/docs/?q=textGe#examples/en/geometries/TextGeometry)

### 6.3.1 -  Types of text

Default FaceTypes:
* helvetiker	helvetiker_regular.typeface.json
* helvetiker	helvetiker_bold.typeface.json
* optimer		optimer_regular.typeface.json
* optimer		optimer_bold.typeface.json
* gentilis	    gentilis_regular.typeface.json
* gentilis	    gentilis_bold.typeface.json
* droid sans	droid/droid_sans_regular.typeface.json
* droid sans	droid/droid_sans_bold.typeface.json
* droid serif	droid/droid_serif_regular.typeface.json
* droid serif	droid/droid_serif_bold.typeface.json

### 6.3.2 - Import font and facetype

1. Inside `three/examples/fonts/`
```javascript
import typefaceFont from 'three/examples/fonts/helvetiker_regular.typeface.json'
```

2. Put the typeface file inside `/static/fonts`, and use de loader:
```javascript
import { FontLoader } from 'three/examples/jsm/loaders/FontLoader.js'
```

* Custom Facetypes

[Custom FaceTypes](https://gero3.github.io/facetype.js/)

### 6.3.3 - Implementation

``` javascript
/**
 * Textures
 */
const textureLoader = new THREE.TextureLoader()
const matcapTexture = textureLoader.load('/textures/matcaps/3.png')

/**
 * Fonts
 */
const fontLoader =  new FontLoader()

fontLoader.load(
    '/fonts/helvetiker_regular.typeface.json',
    (font) => {
        const textGeometry = new TextGeometry(
            'Ivan Xavier',
            {
                font: font,
                size: 0.5,
                height: 0.2,
                curveSegments: 5,
                bevelEnabled: true,
                bevelThickness: 0.03,
                bevelSize: 0.02,
                bevelOffset: 0,
                bevelSegments: 4,
            }
        )
        textGeometry.center()

        const material = new THREE.MeshMatcapMaterial( 
            {   
                matcap: matcapTexture
            } )
        const text = new THREE.Mesh(textGeometry, material)
        
        scene.add(text)
        console.log('Font loaded')
    }
)

```


------


# 6.4 - Particles

1. [Default Geometry](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#641---default-geometry)
2. [Custom Geometry](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#642---custom-geometry)
3. [Particles Map and AlphaMap](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#643---particles-map-and-alphamap)
4. [Randomize colors](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#644---randomize-colors)
5. [Animate particles](https://github.com/ivanxavier7/three.js/tree/main/01%20-%20Basic#645---animate-particles)

* Geometry
* Points Material

[Particle Pack](https://www.kenney.nl/assets/particle-pack)

## 6.4.1 - Default Geometry
``` javascript
/**
 * Particles
 */
const particlesGeometry = new THREE.SphereGeometry(1, 32, 32)
const particlesMaterial = new THREE.PointsMaterial({
    size: 0.02,
    sizeAttenuation: true,
})

const particles = new THREE.Points(particlesGeometry, particlesMaterial)

scene.add(particles)
```
## 6.4.2 - Custom Geometry
``` javascript
/**
 * Particles
 */
const particlesGeometry = new THREE.BufferGeometry()
const count = 5000

const positions = new Float32Array(count * 3)    // x,y,z * 3

for(let i = 0; i < count * 3; i++) {
    positions[i] = (Math.random() - 0.5) * 10
}

particlesGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3))

const particlesMaterial = new THREE.PointsMaterial({
    size: 0.02,
    sizeAttenuation: true,
})

const particles = new THREE.Points(particlesGeometry, particlesMaterial)

scene.add(particles)
```

## 6.4.3 - Particles Map and AlphaMap

To clean the corners of the texture and the areas that we are not supposed to see on the particle

``` javascript
const particlesMaterial = new THREE.PointsMaterial({
    size: 0.02,
    sizeAttenuation: true,
    map: particlesTexture,
    color: new THREE.Color(0, 125, 125),
    transparent: true,
    alphaMap: particlesTexture,
    depthWrite: true,

    // Blending
    depthWrite: false,
    blending: THREE.AdditiveBlending    // Makes the particle in front of another brighter, impact the performance
})
```
## 6.4.4 - Randomize colors

We create a random value for R, G and B

``` javascript	
const positions = new Float32Array(count * 3)    // x,y,z * 3
const colors = new Float32Array(count * 3) // red, green, blue

for(let i = 0; i < count * 3; i++) {
    positions[i] = (Math.random() - 0.5) * 10
    colors[i] = Math.random()
}

particlesGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3))
particlesGeometry.setAttribute('color', new THREE.BufferAttribute(colors, 3))
```

## 6.4.5 - Animate particles

``` javascript	
/**
 * Animate
 */
const clock = new THREE.Clock()

const tick = () =>
{
    const elapsedTime = clock.getElapsedTime()

    // Update Particles
    // particles.rotation.y = elapsedTime * 0.1

    // Avoid this, you should use a custom shader for better performance
    for(let i=0; i<count; i++) {
        const i3 = i * 3

        const x = particlesGeometry.attributes.position.array[i3]
        particlesGeometry.attributes.position.array[i3 + 1] = Math.sin(elapsedTime + x)
        particlesGeometry.attributes.position.needsUpdate = true
    }

    // Update controls
    controls.update()

    // Render
    renderer.render(scene, camera)

    // Call tick again on the next frame
    window.requestAnimationFrame(tick)
}

tick()
```

------

# Advanced

* [Three.js Docs](https://threejs.org/docs/)

1. [Physics](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#1---physics)
2. [Imported Models](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#2---imported-models)
3. [RayCaster and Mouse Events](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#3---raycaster-and-mouse-events)
4. [Custom Models - Blender](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#4---custom-models---blender)
5. [Environment Map](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#5---environment-mapping-and-ai)
6. [Realistic Render](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#6---realistic-rendering)
7. [Code Structure - Object Oriented](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#7---structure-for-bigger-projects---object-oriented)
8. [Shaders](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8---shaders)
9. [Post-processing](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#9---post-processing)
9. [Performance](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#10---performance)
10. [UV unwrapping](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#11---uv-unwrapping)

------

# 1 - Physics

1. [Libraries](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#11---libraries)
2. [Cannon library](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#12---cannon-library)
3. [Apply Forces](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#13---apply-forces)
4. [Handle Multiple Objects](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#14---handle-multiple-objects)
5. [Performance](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#15---performance)
6. [Events](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#16---events)
7. [Remove Objects](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#17---remove-objects)
8. [Constraints](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#18---constraints)
9. [Aditional Notes](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#19---aditional-notes)
10. [Popular alternatives](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#110---popular-alternatives)


We need to create a physical world and associate it with the THREE.js world

## 1.1 - Libraries

### 1.1.1 - 3D Physics Libraries
* [Ammo.js](https://github.com/kripken/ammo.js)
* [Cannon.js](https://github.com/schteppe/cannon.js?files=1)
* [Oimo.js](https://github.com/lo-th/Oimo.js/)
* [Rapier](https://github.com/dimforge/rapier)

### 1.1.2 - 2D Physics Libraries
* [Matter.js](https://github.com/liabru/matter-js)
* [P2.js](https://github.com/schteppe/p2.js)
* [Planck.js](https://github.com/shakiba/planck.js)
* [Box2D.js](https://github.com/kripken/box2d.js/)
* [Rapier](https://github.com/dimforge/rapier)

## 1.2 - Cannon library

``` bash
npm install --save cannon
```

``` javascript
import CANNON from 'cannon'

/**
 * Physics World
 */
const world = new CANNON.World()
world.gravity.set(0, -9.82, 0)  // Earth gravity   -1 * 9.82

// Materials 
//const concreteMaterial = new CANNON.Material('concrete')
//const plasticMaterial = new CANNON.Material('plastic')
const defaultMaterial = new CANNON.Material('default')

const defaultContactMaterial = new CANNON.ContactMaterial(
    //concreteMaterial,
    //plasticMaterial,
    defaultMaterial,
    defaultMaterial,
    {
        friction: 0.1,              // friction
        restitution: 0.9            // how much does it bounce, 0.3 is default
    }
)

world.addContactMaterial(defaultContactMaterial)

// Body or Objects

// Sphere
const sphereShape = new CANNON.Sphere(0.5)
const sphereBody = new CANNON.Body({
    mass: 1,
    position: new CANNON.Vec3(0, 3, 0),
    shape: sphereShape,
    // material: defaultContactMaterial,
})

world.addBody(sphereBody)

// Floor
const floorShape = new CANNON.Plane()
const floorBody = new CANNON.Body({
    mass: 0,
    shape: floorShape,
    // material: defaultContactMaterial,
})

// Set material on the world
world.defaultContactMaterial = defaultContactMaterial

floorBody.quaternion.setFromAxisAngle(
    new CANNON.Vec3(-1, 0, 0),
    Math.PI * 0.5
)

world.addBody(floorBody)

/**
 * Test sphere
 */
const sphere = new THREE.Mesh(
    new THREE.SphereGeometry(0.5, 32, 32),
    new THREE.MeshStandardMaterial({
        metalness: 0.3,
        roughness: 0.4,
        envMap: environmentMapTexture,
        envMapIntensity: 0.5
    })
)
sphere.castShadow = true
sphere.position.y = 0.5
scene.add(sphere)

/**
 * Floor
 */
const floor = new THREE.Mesh(
    new THREE.PlaneGeometry(10, 10),
    new THREE.MeshStandardMaterial({
        color: '#777777',
        metalness: 0.3,
        roughness: 0.4,
        envMap: environmentMapTexture,
        envMapIntensity: 0.5
    })
)
floor.receiveShadow = true
floor.rotation.x = - Math.PI * 0.5
scene.add(floor)

// ...

/**
 * Animate
 */
const clock = new THREE.Clock()
let oldElapsedTime = 0

const tick = () =>
{
    const elapsedTime = clock.getElapsedTime()
    const deltaTime = elapsedTime - oldElapsedTime
    oldElapsedTime = elapsedTime

    // Update Physics World
    world.step(1 / 60, oldElapsedTime, 3)
    sphere.position.copy(sphereBody.position)

    // ...
}

tick()
```

## 1.3 - Apply Forces

* applyForce           Apply force from a specified point in space
* applyImpulse         Apply force to the velocity instead of the force
* applyLocalForce      Apply force in a specific coordinate
* applyLocalImpulse    Same as applyImpulse in a specific coordinate

``` javascript
// Ball push
sphereBody.applyLocalForce(new CANNON.Vec3(150,0,0), new CANNON.Vec3(0,0,0))

world.addBody(sphereBody)

//...
const tick = () =>
{
    // ...

    // Wind
    sphereBody.applyForce(new CANNON.Vec3( -0.5, 0, 0), sphereBody.position)
    
    //...
}
tick()
```

## 1.4 - Handle Multiple Objects

``` javascript
/**
 * Debug
 */
const gui = new dat.GUI()
const debugObject = {}

debugObject.createSphere = () => {
    createSphere(
        Math.random() * 0.5,
        {
            x: (Math.random() * 0.5) * 3,
            y: 3,
            z: (Math.random() * 0.5) * 3,
        })
}
gui.add(debugObject, 'createSphere')


/**
 * Utils
 */
const objectsToUpdate = []

const sphereGeometry = new THREE.SphereGeometry(1, 20, 20)
const sphereMaterial = new THREE.MeshStandardMaterial({
    metalness: 0.3,
    roughness: 0.4,
    envMap: environmentMapTexture
})

const createSphere = (radius, position) => {
    const mesh = new THREE.Mesh(sphereGeometry, sphereMaterial)

    mesh.castShadow = true
    mesh.position.copy(position)
    mesh.scale.set(radius, radius, radius)

    scene.add(mesh)

    // Physics Body
    const shape = new CANNON.Sphere(radius)

    const body = new CANNON.Body({
        mass: 1,
        position: new CANNON.Vec3(0, 3, 0),
        shape: shape,
        material: defaultMaterial
    })

    body.position.copy(position)
    world.addBody(body)

    // Save objects to update
    objectsToUpdate.push({
        mesh: mesh,
        body: body
    })
}

// Body or Objects
createSphere(0.5, {x: 0, y: 3, z: 0})
createSphere(0.5, {x: 2, y: 3, z: 2})
createSphere(0.5, {x: 3, y: 3, z: 2})

const tick = () =>
{
    const elapsedTime = clock.getElapsedTime()
    const deltaTime = elapsedTime - oldElapsedTime
    oldElapsedTime = elapsedTime

    // Update Physics World
    world.step(1 / 60, deltaTime, 3)

    for(const obj of objectsToUpdate) {
        obj.mesh.position.copy(obj.body.position)
        // Rotating objects after hitting something
        obj.mesh.quaternion.copy(obj.body.quaternion)
    }
    
    // Update controls
    controls.update()

    // Render
    renderer.render(scene, camera)

    // Call tick again on the next frame
    window.requestAnimationFrame(tick)
}

tick()
```

## 1.5 - Performance

`Broadphase`
* NaiveBroadphase - Test collisions between bodies against other bodies
* GridBroadphase - quadrilles the world and oly teste bodies agains other bodies in the same grid box
* SAPBroadphase (Sweep And Prune) - Teste Bodies on arbitrary axes

``` javascript
/**
 * Physics World
 */
const world = new CANNON.World()
world.gravity.set(0, -1, 0)  // Earth gravity   -1 * 9.82
world.broadphase = new CANNON.SAPBroadphase(world)
world.allowSleep = true
```

Allow sleep prevents calculations on objects that are stationary

## 1.6 - Events

* Colide
* Sleep
* Wakeup


``` javascript
/**
 * Sounds
 */
const hitSound = new Audio('/sounds/hit.mp3')

const playHitSound = (collision) => {
    console.log(collision.contact.getImpactVelocityAlongNormal())     // Impact speed
    const impactStrength = collision.contact.getImpactVelocityAlongNormal()

    if(impactStrength > 1.5) {
        
        hitSound.currentTime = 0
        hitSound.play()
    }

    if(impactStrength > 10) {
        hitSound.volume = (1 * Math.random()).toFixed(2)
        console.log((1 * Math.random()).toFixed(2))
    } else if (impactStrength > 7.5) {
        hitSound.volume = 0.75
        console.log((1 * Math.random()).toFixed(2))
    } else if (impactStrength > 5) {
        hitSound.volume = 0.5
        console.log((1 * Math.random()).toFixed(2))
    } else if (impactStrength > 1.5){
        hitSound.volume = 0.25
        console.log((1 * Math.random()).toFixed(2))
    }
}


const createBox = (widht, height, depth, position) => {

    // ...

    body.addEventListener('collide', playHitSound)

    world.addBody(body)

    // ...
}

```

## 1.7 - Remove Objects

``` javascript
/**
 * Debug
 */
const gui = new dat.GUI()
const debugObject = {}

debugObject.reset = () => {
    for(const obj of objectsToUpdate) {
        // Remove Body
        obj.body.removeEventListener('collide', playHitSound)   // remove event listener
        world.removeBody(obj.body)

        // Remove Mesh
        scene.remove(obj.mesh)
    }
    // Empty Array
    objectsToUpdate.slice(0, objectsToUpdate.length)
}
gui.add(debugObject, 'reset')
```

## 1.8 - Constraints

Enable constraints between bodies

* HingeConstraint - acts like a door hinge
* DistanceConstraint - forces the bodies to keep a distance betwwen each other
* LockConstraint - Merges the bodies like if they were one piece
* PointToPointCoinstraint - Glues the bodies to a specific point

[Cannon docs](http://schteppe.github.io/cannon.js/docs/)
You can extract examples, such as cars with their physics in the documentation.

## 1.9 - Aditional Notes

### 1.9.1 - Workers
Workers allow dividing the processor's work between several threads, allowing to improve performance

### 1.9.2 - Change to Cannon-es
More recent

``` bash
npm uninstall --save cannon
npm install --save cannon-es@0.15.1
```
``` javascript
import * as CANNON from 'cannon-es'
```

## 1.10 - Popular alternatives

### 1.10.1 - Ammo.js

* Bullet physics engine
* WebAssembly Support (low-level language)
* More Popular
* More Features
* Harder

### 1.10.2 - Physijs

* Uses Ammo and uses workers natively
* Creates body and mesh in the same object

------

# 2 - Imported Models

1. [Types of Models](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#21---types-of-models)
2. [glTF Formats](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#22---gltf-formats)
3. [Loading the Model](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#23---loading-the-model)
4. [Animations inside the model](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#24---animations-inside-the-model)
5. [THREE.js Online Editor](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#24---animations-inside-the-model)


[glTF free models](https://github.com/KhronosGroup/glTF-Sample-Models)


## 2.1 - Types of Models

3d models can be imported in different [formats](https://en.wikipedia.org/wiki/List_of_file_formats#3dgrapichs), the most popular being:

1. glTF - JSON-Based
2. OBJ
3. FBX
4. STL
5. PLY
6. COLLADA
7. 3DS - 3DSMax

Let's use glTF, increasingly popular because it was made by the Khronos group (OpenGL, WebGL, Vulkan, Collada) and with several partnerships, such as NVidia, AMD, Google, Apple, Nintendo and others

Supports:
* Geometries
* Materials
* Cameras
* Lights
* Scenes
* Animations
* Skeletons
* Morphing
* (...)


## 2.2 - glTF Formats

1. glTF / Default   - JSON representation
2. glTF / Binary    - Binary representation
3. glTF / Embedded  - JSON and Binary representation
4. glTF / Draco     - JSON representation


### 2.2.1 - glTF / Default

* Multiple files
* Model.gltf - JSON that contains cameras, lights, scenes, materials and object transformations
* Model0.bin - Binary file that contains geometries (vertices positions, UV coordinates, normals, colors, etc)
* ModelCM.png - The texture

### 2.2.2 glTF / Binary

* Only one file
* Contains all data compiled in binary
* lighter that default
* harder to modify

### 2.2.3 - glTF / Embedded

* One file
* JSON format
* Texture and Geometries are embedded inside the JSON with binary
* Heavier

### 2.2.4 - glTF / Draco

* Multiple Files
* Lighter than default
* Draco is popular in glTF formats
* Google algorithm under open-source license
* Need DRACOLoader instance - Models with exaggerated size or too much diversity of models

## 2.3 - Loading the Model

``` javascript
import { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js'
import { DRACOLoader } from 'three/examples/jsm/loaders/DRACOLoader'

/**
 * Models
 */

const dracoLoader = new DRACOLoader()
dracoLoader.setDecoderPath('/draco/')   // Decoder already in the static path

const gltfLoader = new GLTFLoader()
gltfLoader.setDRACOLoader(dracoLoader)

gltfLoader.load(
    //'/models/Duck/glTF/Duck.gltf',
    //'/models/Duck/glTF-Binary/Duck.glb',
    //'/models/Duck/glTF-Embedded/Duck.gltf',
    '/models/Duck/glTF-Draco/Duck.gltf',

    //'/models/FlightHelmet/glTF/FlightHelmet.gltf',
    (gltf) => {
        console.log('success')
        console.log(gltf)       // We can import everything from this object or just what we need

        // After adding, extracting from the scene, as it reduces the number of children in the scene, reduces the number of cycles and does not load all objects
        /*
        const children = [...gltf.scene.children]
        for(const child of children){
            scene.add(gltf.scene.children[0])
        }
        */

        scene.add(gltf.scene)   // add everything
    },
    (progress) => {
        console.log('progress')
        console.log(progress)
    },
    (error) => {
        console.log('error')
        console.log(error)
    }
)
```

## 2.4 - Animations inside the model

Imported models can have `AnimationClips`, to use them we need to create an `AnimationMixer`

``` javascript

gltfLoader.load(
    '/models/Fox/glTF/Fox.gltf',
    (gltf) => {
        mixer = new THREE.AnimationMixer(gltf.scene)
        const action = mixer.clipAction(gltf.animations[0])     // First Animation

        action.play()

        gltf.scene.scale.set(0.025, 0.025, 0.025)

        scene.add(gltf.scene)   // add everything
    }
)

const tick = () =>
{
    const elapsedTime = clock.getElapsedTime()
    const deltaTime = elapsedTime - previousTime
    previousTime = elapsedTime

    // Update Mixer
    if(mixer !== null) {
        mixer.update(deltaTime)
    }
    // (...)
}
```

## 2.5 - THREE.js Online Editor

We can use the online editor to preview the models before importing them
[THREE.js Editor](https://threejs.org/editor/)

* Add Ambient Light
* Add Directional Light
* Import Model

------

# 3 - Raycaster and Mouse Events

1. [Intersect properties](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#31---intersect-properties)
2. [Horizontal Ray](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#32---horizontal-ray)
3. [Mouse Events](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#33---mouse-events)


This Casts an ray in specific direction and trigger a event if so, consumes a lot of resources

Usage examples:
* Collision with an wall
* Shooting a gun in a game
* Something under the mouse pointer
* Show alert message if player is leaving the map

## 3.1 - Intersect properties

Intersect and Intersects objects contains:
* `distance` - Distance between the origin of the ray and the collision point
* `face` -  What face of geometry was hit by the ray
* `faceIndex` - The index of the face
* `object` - Object concerned by the collision
* `Point` - Vector3 of the exact point of the collision
* `uv` -  UV coordinates in that geometry

## 3.2 - Horizontal Ray

Tests when three spheres pass through the beam and changes its color when that happens

``` JavaScript
/**
 * Raycaster
 */
object1.updateMatrixWorld()
object2.updateMatrixWorld()
object3.updateMatrixWorld()
const raycaster = new THREE.Raycaster()

/**
 * Animate
 */
const clock = new THREE.Clock()

const tick = () =>
{
    const elapsedTime = clock.getElapsedTime()

    // Cast a ray
    const rayOrigin = new THREE.Vector3(-3, 0, 0)
    const rayDirection = new THREE.Vector3(10, 0, 0)
    rayDirection.normalize() // We need a vector with 1 length(unit vector), normalize do that with the same direction

    raycaster.set(rayOrigin, rayDirection)

    // Check ray intersections
    const objectsToTest = [object1, object2, object3]
    const intersects = raycaster.intersectObjects(objectsToTest)
    console.log(intersects)

    for(const object of objectsToTest) {
        object.material.color.set('#ff0000')
    }

    // See intersected objects
    for(const intersect of intersects) {
        intersect.object.material.color.set('#0000ff')
    }

    // Animate spheres
    object1.position.y = Math.sin(elapsedTime * 0.3) * 1.5
    object2.position.y = Math.sin(elapsedTime * 0.8) * 1.5
    object3.position.y = Math.sin(elapsedTime * 1.4) * 1.5

    // (...)

tick()
```

## 3.3 - Mouse Events

Tests when the mouse pointer is above the object and changes its color

1. [Hovering](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#331---hovering)
2. [Clicking](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#332---clicking)

### 3.3.1 - Hovering

We also have a section dedicated to when the mouse pointer is inside or outside the object

``` javascript
/**
 * Mouse Events
 */
const mouse = new THREE.Vector2()

window.addEventListener('mousemove', (_event) => {
    mouse.x = _event.clientX / sizes.width * 2 - 1          // screen X between -1 and 1
    mouse.y = - (_event.clientY / sizes.height) * 2 + 1     // screen Y between -1 and 1
})

scene.add(mouse)

/**
 * Animate
 */
const clock = new THREE.Clock()

// Check mouseEnter or leave the object
let currentIntersect = null

const tick = () =>
{
    const elapsedTime = clock.getElapsedTime()

    raycaster.setFromCamera(mouse, camera)

    const objectsToTest = [object1, object2, object3]
    const intersects = raycaster.intersectObjects(objectsToTest)

    for(const object of objectsToTest) {
        object.material.color.set('#ff0000')
        object.scale.set(1, 1, 1)
    }

    for(const intersect of intersects) {
        intersect.object.material.color.set('#0000ff')
        intersect.object.scale.set(1.2, 1.2, 1.2)
    }

    if(intersects.length) {
        if(!currentIntersect) {         // Test if it is new
            console.log('mouse enter')
        }

        currentIntersect = intersects[0]
    } else {
        if(currentIntersect) {          // Test if it is old
            console.log('mouse out')
        }

        currentIntersect = null
    }

    // (...)
}

tick()
```

### 3.3.2 - Clicking

``` javascript
/**
 * Mouse Events
 */
const mouse = new THREE.Vector2()

window.addEventListener('click', (_event) => {
    mouse.x = _event.clientX / sizes.width * 2 - 1          // screen X between -1 and 1
    mouse.y = - (_event.clientY / sizes.height) * 2 + 1     // screen Y between -1 and 1
})
```

------


# 4 - Custom Models - Blender

1. [Layout](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#41---layout)
2. [Scene](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#42---scene)
3. [View](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#43---view)
4. [Object](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#44---object)
5. [Selection](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#45---selection)
6. [Modes](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#46---modes)
7. [Edition](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#47---edition)
8. [Curves](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#48---curves)
9. [Render](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#49---render)
10. [Timeline](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#410---timeline)
11. [Export model](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#411---export-model)
12. [More Blender Youtube resources](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#412---more-blender-youtube-resources)


* Free
* Good performance
* Light
* Works on most OS
* Features
* Community


[Blender](https://docs.blender.org/)


## 4.1 - Layout
| Shortcut                  | Description                       |
| ------------------------  |:-------------------------------:  |
| `N`                       | Toggle sidebar                    |
| `T`                       | Toggle Tools                      |
| `Space` + `Control`       | Maximize area                     |
| `Q`                       | Favorites                         |
| `F3`                      | Search action                     |
| `Z` +  `Control`          | Undo                              |
| `Z` + `Space` + `Control` | Redo                              |


## 4.2 - Scene
| Shortcut              | Description          |
| --------------------  |:------------------:  |
| `C`                   | New collection       |
| `M`                   | Move to collection   |


## 4.3 - View
| Shortcut                               | Description                 |
| -------------------------------------  |:-------------------------:  |
| `Middle Wheel`                         | Rotate                      |
| `Middle Wheel` + `Shift`               | Pan                         |
| `Middle Wheel` + `Control`             | Zoom                        |
| `Middle Wheel` + `Control` + `Shift`   | Dolly                       |
| `.` or `,`                             | Focus section               |
| `5`                                    | Ortho/Perspective           |
| `1` or `3` or `7`                      | Axis (Control to invert)    |
| `7` +  `Shift`                         | Position in front           |
| `0`                                    | Position on Camera          |
| `0` + `Control`                        | Position on active camera   |
| `Z`                                    | Shading wheel               |
| `Z` + `Alt`                            | X-ray                       |
| `S` +  `Shift`                         | Change cursor position      |
| `C` +  `Shift`                         | Focus scene                 |
| `Q` + `Alt` + `Control`                | Quad view                   |


## 4.4 - Object
| Shortcut                        | Description                 |
| ------------------------------  |:-------------------------:  |
| `A` +  `Shift`                  | Create an object            |
| `F9`                            | Re-open creation option     |
| `X`                             | Delete                      |
| `A` + `Control`                 | Apply transformations       |
| `G`                             | Translate                   |
| `X` or `Y` or `Z`               | Force axis                  |
| `X` or `Y` or `Z` + `Shift`     | Axis with precision         |
| `X` or `Y` or `Z` + `Control`   | Axis rounded                |
| `R`                             | Rotate                      |
| `S`                             | Scale                       |
| `G` + `Alt`                     | Reset position              |
| `R` + `Alt`                     | Reset rotation              |
| `S` + `Alt`                     | Reset scale                 |
| `Tab` + `Shift`                 | Toggle snap                 |
| `D` + `Shift`                   | Duplicate                   |
| `D` + `Alt`                     | Link-duplicate              |
| `H`                             | Hide selection              |
| `H` + `Shift`                   | Isolate                     |
| `/`                             | Isolate and focus           |
| `H` + `Alt`                     | Unhide all                  |
| `J` + `Control`                 | Merge                       |
| `R` + `Shift`                   | Repeat last                 |


## 4.5 - Selection
| Shortcut                        | Description                 |
| ------------------------------  |:-------------------------:  |
| `A`                             | Select all                  |
| `A` + `A`                       | Unselect all                |
| `B`                             | Border section              |
| `C`                             | Circle section              |
| `Mouse Wheel`                   | Change size                 |
| `I` + `Control`                 | Invert selection            |
| `Left Click` + `Shift`          | To/remove from selection    |
| `.`                             | Go to selected object       |


## 4.6 - Modes
| Shortcut                        | Description                 |
| ------------------------------  |:-------------------------:  |
| `Tab` + `Control`               | Change mode                 |

## 4.7 - Edition
| Shortcut                           | Description                 |
| ---------------------------------  |:-------------------------:  |
| `Tab`                              | Toggle edition              |
| `1`                                | Vertex                      |
| `2`                                | Edges                       |
| `3`                                | Faces                       |
| `Left Click` + `Alt`               | Edge loop selection         |
| `Left Click` + `Alt` + `Control`   | Parallel edge selection     |
| `G` + `G`                          | Translate on edge           |
| `E`                                | Extrude                     |
| `E` + `Alt`                        | Extrude with options        |
| `I`                                | Inset                       |
| `I` + `I`                          | Individual inset            |
| `B` + `Control`                    | Bevel                       |
| `R` + `Control`                    | Loop cut                    |
| `J`                                | Connect vertices            |
| `K`                                | Knife cut                   |
| `Z`                                | Cut through                 |
| `P`                                | Separate                    |
| `F`                                | Create edge or face         |
| `V`                                | Rip                         |
| `T` + `Control`                    | Triangulate                 |
| `M` + `Alt`                        | Merge                       |
| `L` + `Control`                    | Select island               |
| `E` + `Shift`                      | Change crease               |
| `U`                                | Unwrap menu                 |
| `M`                                | Merge                       |


## 4.8 - Curves
| Shortcut        | Description          |
| -------------   |:------------------:  |
| `C`             | Toggle open          |
| `V`             | Change handle type   |
| `S` + `Alt`     | Change thickness     |
| `F`             | Change brush size    |


## 4.9 - Render
| Shortcut                  | Description          |
| ------------------------  |:------------------:  |
| `F12`                     | Render               |
| `B` + `Control`           | Set render region    |
| `B` + `Alt` + `Control`   | Reset render region  |


## 4.10 - Timeline
| Shortcut        | Description          |
| --------------  |:------------------:  |
| `Arrow Right`   | Next frame           |
| `Arrow Left`    | Previous frame       |
| `Arrow Up`      | Next keyframe        |
| `Arrow Down`    | Previous keyframe    |
| `,`             | Focus selection      |
| `I`             | Insert keyframe      |
| `T`             | Choose interpolation |
| `P`             | Define range         |
| `P` + `Alt`     | Reset range          |
| `V`             | Handle type          |

## 4.11 - Export model

1. Select objects to be exported
2. File -> Export -> glTF 2.0
3. Choose file format
4. Choose project static/models folder

## 4.12 - More Blender Youtube resources

* [Blender Guru](https://www.youtube.com/@blenderguru)
* [Grant Abbitt](https://www.youtube.com/@grabbitt)
* [CGFastTrack](https://www.youtube.com/@CGFastTrack)
* [CGCookie](https://www.youtube.com/@cg_cookie)

------

# 5 - Environment Mapping and AI

1. [Download resources](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#51-download-resources)
2. [Implementation](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#52---implementation)
3. [Blur and Light](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#53---blur-and-light)
4. [HDRI Equirectangular Environment Map](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#54---hdri-equirectangular-environment-map)
5. [Generate HDRI](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#55---generate-hdri)
6. [Bring object inside Environment Map closer to the ground](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#56---bring-object-inside-environment-map-closer-to-the-ground)
7. [Real-Time Environment Map](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#57---real-time-environment-map)


## 5.1. Download Resources
See how to load models or environment maps in the basics part

Models
* [Sketchfab](https://sketchfab.com/)
* [Turbosquid](https://www.turbosquid.com/)
* [DownloadFree3D](https://downloadfree3d.com/file-format/gltf/)

HDRI
* [Poly Haven](https://polyhaven.com/)

Convert to 6 PNG, cube map textures with [HDRI to CubeMap](https://matheowis.github.io/HDRI-to-CubeMap/)


## 5.2 - Implementation

``` javascript
scene.environment = environmentMap  // apply environment map as lighting to the whole scene
scene.background = environmentMap   // apply background
```

## 5.3 - Blur and Light

``` javascript
import { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js'

/**
 * Load Model
 */
const glTFLoader = new GLTFLoader()
glTFLoader.load(
    '/models/FlightHelmet/glTF/FlightHelmet.gltf',
    (gltf) => {
        gltf.scene.scale.set(10, 10, 10)
        scene.add(gltf.scene)

        updateAllMaterials()
    }
)

/**
 * Update all materials
 */
const updateAllMaterials = () => {
    // Accessing All 3D objects in the scene
    scene.traverse((child) => {
        // Update only in the MeshStandardMaterial Objects
        if(child.isMesh && child.material.isMeshStandardMaterial){
            child.material.envMapIntensity = global.envMapIntensity  // light intensity
        }
    })
}

/**
 * Load EnvironmentMap
 */
global.envMapIntensity = 1
gui.add(global, 'envMapIntensity')
    .min(0)
    .max(10)
    .step(0.001)
    .onChange(updateAllMaterials)

const cubeTextureLoader = new THREE.CubeTextureLoader()
const environmentMap = cubeTextureLoader.load([
    '/environmentMaps/2/px.png',
    '/environmentMaps/2/nx.png',
    '/environmentMaps/2/py.png',
    '/environmentMaps/2/ny.png',
    '/environmentMaps/2/pz.png',
    '/environmentMaps/2/nz.png',
])

scene.backgroundBlurriness = 0    // Blur
scene.backgroundIntensity = 1       // Background brightness
scene.environment = environmentMap  // apply environment map as lighting to the whole scene
scene.background = environmentMap   // apply background

gui.add(scene, 'backgroundBlurriness')
    .min(0)
    .max(10)
    .step(0.001)

gui.add(scene, 'backgroundIntensity')
    .min(0)
    .max(10)
    .step(0.001)    
```

## 5.4 - HDRI Equirectangular Environment Map

High Dynamic Range Image, color valus stored have much higher values range than traditional images, only one file

`file.hdr`

`RGBELoader` - Red Green Blue Exponent, encoding for the HDR format

``` javascript
import { RGBELoader } from 'three/examples/jsm/loaders/RGBELoader.js'

const rgbeLoader = new RGBELoader()

rgbeLoader.load('/environmentMaps/0/2k.hdr', (environmentMap) => {
    console.log(environmentMap)
    environmentMap.mapping = THREE.EquirectangularReflectionMapping

    scene.environment = environmentMap
    scene.background = environmentMap
    scene.backgroundBlurriness = 0.08
})
```

## 5.5 - Generate HDRI

1. Blender
2. AI NVidia Canvas
3. Skybox Lab
4. Load JPEG file


### 5.5.1 - Blender
1. Reduce max sampling from 4096 to 512
2. Add black background to the scene
3. Change resolution to 2048x1024
4. Add camera in the middle of the scene
5. Change lens from perspective to panoramic and choose Equirectangular
6. To see the lights in the render go to Object->visibility-> enable camera
7. Save the image with radiance .hdr format


### 5.5.2 - AI NVidia Canvas

Only for Windows with NVidia RTX

[NVidia Canvas](https://www.nvidia.com/en-us/studio/canvas/)


### 5.5.3 - Skybox Lab

Write something to ask the AI and it will generate the HDRI, use generate depth


#### 5.5.4 - Load JPEG file

``` javascript
// LDR Equirectangular
const textureLoader = new THREE.TextureLoader()
const environmentMap = textureLoader.load('/environmentMaps/blockadesLabsSkybox/anime_art_style_japan_streets_with_cherry_blossom_.jpg')

environmentMap.mapping = THREE.EquirectangularReflectionMapping
environmentMap.colorSpace = THREE.SRGBColorSpace
global.envMapIntensity = 3
scene.environment = environmentMap
scene.background = environmentMap
```


## 5.6 - Bring object inside Environment Map closer to the ground

``` javascript
import { GroundProjectedSkybox } from 'three/examples/jsm/objects/GroundProjectedSkybox.js'


const rgbeLoader = new RGBELoader()

rgbeLoader.load('/environmentMaps/3/2k.hdr', (environmentMap) => {

    // (...)

    const skybox = new GroundProjectedSkybox(environmentMap)
    skybox.scale.setScalar(50)
    scene.add(skybox)
})

```

## 5.7 - Real-Time Environment Map

Allows an object to illuminate others and see its reflections with the environment map, we can organize it by layers

``` javascript	
/**
 * Light Donut
 */
const lightDonut = new THREE.Mesh(
    new THREE.TorusGeometry(8, 0.5),
    new THREE.MeshStandardMaterial({ color: new THREE.Color(10, 8, 8) }),
)

lightDonut.position.y = 3.5
lightDonut.layers.enable(1)
scene.add(lightDonut)

// Cube render target for the lights
const cubeRenderTarget = new THREE.WebGLCubeRenderTarget(
    256,
    {
        type: THREE.FloatType
    }
)

scene.environment = cubeRenderTarget.texture

// Cube camera
const cubeCamera = new THREE.CubeCamera(0.1, 100, cubeRenderTarget)
cubeCamera.layers.set(1)

/**
 * Animate
 */
const clock = new THREE.Clock()
const tick = () =>
{
    // Time
    const elapsedTime = clock.getElapsedTime()

    // Animate light donut
    if(lightDonut) {
        lightDonut.rotation.x = Math.sin(elapsedTime) * 2

        cubeCamera.update(renderer, scene)
    }

    // (...)
}

tick()
```

------

# 6 - Realistic Rendering

1. [Tone Maping](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#61---tone-maping)
2. [Antialiasing](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#62---antialiasing)
3. [Add Shadow to Environment Map](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#63---add-shadow-to-environment-map)
4. [Textures](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#64---textures)

## 6.1 - Tone Maping

Convert HDR(High Dynamic Range) to LDR(Low Dynamic Range)

* `NoToneMapping` - Without mapping the tone
* `LinearToneMapping` - Lights everything
* `ReinhardToneMapping` - Realistic with a poorly set camera
* `CineonToneMapping` - High contrast
* `ACESFilmicToneMapping` - Higher contrast

``` javascript
// Tone Mapping
renderer.toneMapping = THREE.ACESFilmicToneMapping

gui.add(renderer, 'toneMapping', {
    No: THREE.NoToneMapping,
    Linear: THREE.LinearToneMapping,
    Reinhard: THREE.ReinhardToneMapping,
    Cineon: THREE.CineonToneMapping,
    ACESFilmic: THREE.ACESFilmicToneMapping
})
```

## 6.2 - Antialiasing

Reduce ladder-like pixels when we zoom a lot and have high contrast

* SSAA/FSAA - Super Sampling or Fullscreen Sampling (4x more pixels and more time to render)
* MSSA - Multi Sampling (Check the neighbours and mix its colors on the geometry edges)

``` javascript
/**
 * Renderer
 */
const renderer = new THREE.WebGLRenderer({
    canvas: canvas,
    antialias: true,
})
```

## 6.3 - Add Shadow to Environment Map

Create a Light, disable the default lighting and create shadowMaps

``` javascript

/**
 * Update all materials
 */
const updateAllMaterials = () =>
{
    scene.traverse((child) =>
    {
        if(child.isMesh && child.material.isMeshStandardMaterial)
        {
            // (...)

            child.castShadow = true
            child.receiveShadow = true
        }
    })
}

/**
 * Lights
 */
const directionalLight = new THREE.DirectionalLight( '#ffffff', 2)
directionalLight.position.set(0, 7, 6)
directionalLight.target.position.set(0, 6.5, -2) // Target of the light
directionalLight.shadow.camera.far = 15 // limit the distante with the camera helper
directionalLight.shadow.mapSize.set(512, 512) // Optimize shadowmap
directionalLight.target.updateWorldMatrix()
scene.add(directionalLight)

gui.add(directionalLight, 'intensity').min(0).max(10).step(0.001).name('lightIntensity')
gui.add(directionalLight.position, 'x').min(-10).max(10).step(0.001).name('lightX')
gui.add(directionalLight.position, 'y').min(-10).max(10).step(0.001).name('lightY')
gui.add(directionalLight.position, 'z').min(-10).max(10).step(0.001).name('lightZ')

// Shadows
renderer.shadowMap.enabled = true
renderer.shadowMap.type = THREE.PCFSoftShadowMap
directionalLight.castShadow = true

/*
// Light Helper for the shadow
const directionalLightCameraHelper = new THREE.CameraHelper(directionalLight.shadow.camera)
scene.add(directionalLightCameraHelper)
*/

gui.add(directionalLight, 'castShadow')

// Turn off default lighting, its irealistic
renderer.useLegacyLights = false
gui.add(renderer, 'useLegacyLights')

```

## 6.4 - Textures

[Poly Haven Textures](https://polyhaven.com/textures)

And choose the following options:

* Normal(GL) - PNG -  Normal
* AO/Rough/Metal - JPG - Ambient Occlusion, Roughness and Metalness
* Diffuse- JPG - Color

Change diffuse/color from linear to SRGB

``` javascript
colorTexture.colorSpace = three.SRGBColorSpace
```

If there are bugs between the shadows in the texture we can fix them with these parameters:

* `bias` - flat surfaces
* `normalBias` - rounded surfaces

Test the perfect value with gui
``` javascript
gui.add(directionalLight.shadow, 'normalBias').min(-0.05).max(0.05).step(0.001)
gui.add(directionalLight.shadow, 'bias').min(-0.05).max(0.05).step(0.001)

directionalLight.shadow.bias = 0.01
```

------

# 7 - Structure for Bigger Projects - Object Oriented

1. [Classes and Modules](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#71----classes-and-modules)
2. [Object Oriented Structure](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#72----object-oriented-structure)

* Modules
* Classes

## 7.1 -  Classes and Modules

`Robot.js`
``` javascript
export default class Robot
{
    constructor(name, legs)
    {
        this.name = name;
        this.legs = legs;
        console.log(`Robot ${name} created!`)
    }

    sayHi()
    {
        console.log(`Hello! My name is ${this.name}`)
    }
}
```

`FlyingRobot.js`
``` javascript
import Robot from './Robot.js';

export default class FlyingRobot extends Robot
{
    constructor(name, legs) {
        super(name, legs)
        this.canFly = true
    }
    sayHi()
    {
        super.sayHi()
        console.log(`Function overwriten`)
    }

    takeOff() {
        console.log(`Robot ${this.name} is taking off`)
    }

    land() {
        console.log(`Robot ${this.name} is landing`)
    }
}
```

`script.js`
``` javascript
import Robot from './Robot.js';
import FlyingRobot from './FlyingRobot';

const wallE = new Robot('Wall-E', 0)
const ultron = new FlyingRobot('Ultron', 2)
const astroBoy = new FlyingRobot('Astro Boy', 2)
const megaMan = new Robot('Mega-Man', 2)

wallE.sayHi()
megaMan.sayHi()

ultron.sayHi()
ultron.takeOff()
ultron.land()
```

## 7.2 -  Object Oriented Structure

- `intex.html`
- `script.jsx`
- `style.css`
- `/Application`
    - `Application.jsx` - Main application
    - `Camera.jsx` - Camera
    - `Renderer.jsx` - Renderer
    - `sources.jsx` - Array of sources paths to load 
    - `/Utils`
        - `Debug.jsx` - Debug console
        - `EventEmitter.jsx` - Returns a string whenever an event is triggered so that it can be accessed by other classes in a simple way
        - `Resources.jsx` - Loads the resources
        - `Sizes.jsx` - Handle the size and resize oh the window
        - `Time.jsx` - Handle the time for animations
    - `/World` - Objects
        - `Environment.jsx`
        - `Floor.jsx`
        - `Fox.jsx`
        - `World.jsx`


### 7.2.1 - `index.html`
``` html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>27 - Code structuring</title>
    <link rel="stylesheet" href="./style.css">
</head>
<body>
    <canvas class="webgl"></canvas>
    <script type="module" src="./script.js"></script>
</body>
</html>
```


### 7.2.2 - `script.jsx`
``` javascript
import Application from './Application/Application'

const application = new Application(document.querySelector('canvas.webgl'))
```


### 7.2.3 - `style.css`
``` css
*
{
    margin: 0;
    padding: 0;
}

html,
body
{
    overflow: hidden;
}

.webgl
{
    position: fixed;
    top: 0;
    left: 0;
    outline: none;
}
```


### 7.2.4 - `/Application`

#### 7.2.4.1 - `Application.jsx`
``` javascript
import * as THREE from 'three'

import Sizes from './Utils/Sizes.js'
import Time from './Utils/Time.js'
import Resources from './Utils/Resources.js'
import Debug from './Utils/Debug.js'

import Camera from './Camera.js'
import Renderer from './Renderer.js'
import World from './World/World.js'

import sources from "./sources";

let instance = null // singleton, we can instantiate multiple times but we will get the same instance

export default class Application
{
    constructor(_canvas)
    {
        // Singleton
        if(instance)
        {
            return instance
        }
        instance = this

        // Global access / Can access all variables and functions in the console
        window.application = this

        // Options
        this.canvas = _canvas

        // Setup
        this.debug = new Debug()
        this.sizes = new Sizes()
        this.time = new Time()
        this.scene = new THREE.Scene()
        this.resources = new Resources(sources)
        this.camera = new Camera()
        this.renderer = new Renderer()
        this.world = new World()

        this.sizes.on('resize', () =>       // Arrow function () => don lose the context (this.something), but function does
        {
            this.resize()
        })

        this.time.on('tick', () =>
        {
            this.update()
        })
    }

    resize()
    {
        this.camera.resize()
        this.renderer.resize()
    }

    update()
    {
        this.camera.update()
        this.world.update()
        this.renderer.update()
    }

    destroy()
    {
        // Remove event listeners
        this.sizes.off('resize')
        this.time.off('tick')
        // Can remove the rest of the eventListener with js (removeEventListener)

        this.scene.traverse((child) =>
        {
            if(child instanceof THREE.Mesh)
            {
                // Remove object
                child.geometry.dispose()

                // Remove object properties
                for(const key in child.material)
                {
                    const value = child.material[key]

                    if(value && typeof value.dispose === 'function')
                    {
                        value.dispose()
                    }
                }
            }
        })

        // Remove camera controls
        this.camera.controls.dispose()

        // Remove renderer
        this.renderer.instance.dispose()

        // Remove debug
        if(this.debug.active)
        {
            this.debug.ui.destroy()
        }
    }
}
```

#### 7.2.4.2 - `Camera.jsx`
``` javascript
import * as THREE from 'three'
import { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js'

import Application from "./Application"

export default class Camera
{
    constructor()
    {
        this.application = new Application()
        this.sizes = this.application.sizes
        this.scene = this.application.scene
        this.canvas = this.application.canvas

        this.setInstance()
        this.setControls()
        this.resize()
    }

    setInstance()
    {
        this.instance = new THREE.PerspectiveCamera(
            35,
            this.sizes.width /
            this.sizes.height,
            0.1,
            100)

        this.instance.position.set(6, 4, 8)

        this.scene.add(this.instance)
    }

    setControls()
    {
        this.controls = new OrbitControls(this.instance, this.canvas)
        this.controls.enableDampling = true
    }

    resize()
    {
        this.instance.aspect = this.sizes.width / this.sizes.height
        this.instance.updateProjectionMatrix()
    }

    update()
    {
        this.controls.update()
    }
}
```

#### 7.2.4.3 - `Renderer.jsx`
``` javascript
import Application from "./Application";

import * as THREE from 'three'

export default class Renderer
{
    constructor()
    {
        this.application = new Application()
        this.canvas = this.application.canvas
        this.sizes = this.application.sizes
        this.scene = this.application.scene
        this.camera = this.application.camera

        this.setInstance()
    }

    setInstance()
    {
        this.instance = new THREE.WebGLRenderer({
            canvas: this.canvas,
            antialias: true
        })
        
        this.instance.useLegacyLights = false
        this.instance.toneMapping = THREE.CineonToneMapping
        this.instance.toneMappingExposure = 1.75
        this.instance.shadowMap.enabled = true
        this.instance.shadowMap.type = THREE.PCFSoftShadowMap
        this.instance.setClearColor('#211d20')
        this.instance.setSize(this.sizes.width, this.sizes.height)
        this.instance.setPixelRatio(this.sizes.pixelRatio)
    }

    resize()
    {
        this.instance.setSize(this.sizes.width, this.sizes.height)
        this.instance.setPixelRatio(this.sizes.pixelRatio)
    }

    update()
    {
        this.instance.render(this.scene, this.camera.instance)
    }
}
```

#### 7.2.4.4 - `sources.jsx`
``` javascript
export default [
    {
        name: 'environmentMapTexture',
        type: 'cubeTexture',
        path:
        [
            'textures/environmentMap/px.jpg',
            'textures/environmentMap/nx.jpg',
            'textures/environmentMap/py.jpg',
            'textures/environmentMap/ny.jpg',
            'textures/environmentMap/pz.jpg',
            'textures/environmentMap/nz.jpg'
        ]
    },
    {
        name: 'grassColorTexture',
        type: 'texture',
        path: 'textures/dirt/color.jpg'
    },
    {
        name: 'grassNormalTexture',
        type: 'texture',
        path: 'textures/dirt/normal.jpg'
    },
    {
        name: 'foxModel',
        type: 'gltfModel',
        path: 'models/Fox/glTF/Fox.gltf'
    }
]
```

### 7.2.5 - `/Utils`

#### 7.2.5.1 - `Debug.jsx`
``` javascript
import * as dat from 'lil-gui'

export default class Debug
{
    constructor()
    {
        this.active = window.location.hash == '#debug'

        if(this.active)
        {
            this.ui = new dat.GUI()
        }
    }
}
```

#### 7.2.5.2 - `EventEmitter.jsx`
``` javascript
export default class EventEmitter
{
    constructor()
    {
        this.callbacks = {}
        this.callbacks.base = {}
    }

    on(_names, callback)
    {
        // Errors
        if(typeof _names === 'undefined' || _names === '')
        {
            console.warn('wrong names')
            return false
        }

        if(typeof callback === 'undefined')
        {
            console.warn('wrong callback')
            return false
        }

        // Resolve names
        const names = this.resolveNames(_names)

        // Each name
        names.forEach((_name) =>
        {
            // Resolve name
            const name = this.resolveName(_name)

            // Create namespace if not exist
            if(!(this.callbacks[ name.namespace ] instanceof Object))
                this.callbacks[ name.namespace ] = {}

            // Create callback if not exist
            if(!(this.callbacks[ name.namespace ][ name.value ] instanceof Array))
                this.callbacks[ name.namespace ][ name.value ] = []

            // Add callback
            this.callbacks[ name.namespace ][ name.value ].push(callback)
        })

        return this
    }

    off(_names)
    {
        // Errors
        if(typeof _names === 'undefined' || _names === '')
        {
            console.warn('wrong name')
            return false
        }

        // Resolve names
        const names = this.resolveNames(_names)

        // Each name
        names.forEach((_name) =>
        {
            // Resolve name
            const name = this.resolveName(_name)

            // Remove namespace
            if(name.namespace !== 'base' && name.value === '')
            {
                delete this.callbacks[ name.namespace ]
            }

            // Remove specific callback in namespace
            else
            {
                // Default
                if(name.namespace === 'base')
                {
                    // Try to remove from each namespace
                    for(const namespace in this.callbacks)
                    {
                        if(this.callbacks[ namespace ] instanceof Object && this.callbacks[ namespace ][ name.value ] instanceof Array)
                        {
                            delete this.callbacks[ namespace ][ name.value ]

                            // Remove namespace if empty
                            if(Object.keys(this.callbacks[ namespace ]).length === 0)
                                delete this.callbacks[ namespace ]
                        }
                    }
                }

                // Specified namespace
                else if(this.callbacks[ name.namespace ] instanceof Object && this.callbacks[ name.namespace ][ name.value ] instanceof Array)
                {
                    delete this.callbacks[ name.namespace ][ name.value ]

                    // Remove namespace if empty
                    if(Object.keys(this.callbacks[ name.namespace ]).length === 0)
                        delete this.callbacks[ name.namespace ]
                }
            }
        })

        return this
    }

    trigger(_name, _args)
    {
        // Errors
        if(typeof _name === 'undefined' || _name === '')
        {
            console.warn('wrong name')
            return false
        }

        let finalResult = null
        let result = null

        // Default args
        const args = !(_args instanceof Array) ? [] : _args

        // Resolve names (should on have one event)
        let name = this.resolveNames(_name)

        // Resolve name
        name = this.resolveName(name[ 0 ])

        // Default namespace
        if(name.namespace === 'base')
        {
            // Try to find callback in each namespace
            for(const namespace in this.callbacks)
            {
                if(this.callbacks[ namespace ] instanceof Object && this.callbacks[ namespace ][ name.value ] instanceof Array)
                {
                    this.callbacks[ namespace ][ name.value ].forEach(function(callback)
                    {
                        result = callback.apply(this, args)

                        if(typeof finalResult === 'undefined')
                        {
                            finalResult = result
                        }
                    })
                }
            }
        }

        // Specified namespace
        else if(this.callbacks[ name.namespace ] instanceof Object)
        {
            if(name.value === '')
            {
                console.warn('wrong name')
                return this
            }

            this.callbacks[ name.namespace ][ name.value ].forEach(function(callback)
            {
                result = callback.apply(this, args)

                if(typeof finalResult === 'undefined')
                    finalResult = result
            })
        }

        return finalResult
    }

    resolveNames(_names)
    {
        let names = _names
        names = names.replace(/[^a-zA-Z0-9 ,/.]/g, '')
        names = names.replace(/[,/]+/g, ' ')
        names = names.split(' ')

        return names
    }

    resolveName(name)
    {
        const newName = {}
        const parts = name.split('.')

        newName.original  = name
        newName.value     = parts[ 0 ]
        newName.namespace = 'base' // Base namespace

        // Specified namespace
        if(parts.length > 1 && parts[ 1 ] !== '')
        {
            newName.namespace = parts[ 1 ]
        }

        return newName
    }
}
```

#### 7.2.5.3 - `Resources.jsx`
``` javascript
import * as THREE from 'three'

import EventEmitter from "./EventEmitter";
import { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js'

export default class Resources extends EventEmitter
{
    constructor(sources)
    {
        super()

        // Options
        this.sources = sources

        // Setup
        this.items = {}
        this.toLoad = this.sources.length
        this.loaded = 0

        this.setLoaders()
        this.startLoading()
    }

    setLoaders()
    {
        this.loaders = {}
        this.loaders.gltfLoader = new GLTFLoader()
        this.loaders.textureLoader = new THREE.TextureLoader()
        this.loaders.cubeTextureLoader = new THREE.CubeTextureLoader()
        // Add draco compression if needed
    }

    startLoading()
    {
        // Load sources
        for(const source of this.sources)
        {
            if(source.type === 'gltfModel')
            {
                this.loaders.gltfLoader.load(
                    source.path,
                    (file) =>
                    {
                        this.sourceLoaded(source, file)
                    }
                )
            }
            else if(source.type === 'texture')
            {
                this.loaders.textureLoader.load(
                    source.path,
                    (file) =>
                    {
                        this.sourceLoaded(source, file)
                    }
                )
            }
            else if(source.type === 'cubeTexture')
            {
                this.loaders.cubeTextureLoader.load(
                    source.path,
                    (file) =>
                    {
                        this.sourceLoaded(source, file)
                    }
                )
            }
        }
    }

    sourceLoaded(source, file)
    {
        this.items[source.name] = file

        //console.log(this.items)

        this.loaded++

        if(this.loaded === this.toLoad)
        {
            this.trigger('resourcesLoaded')
        }
    }
}
```

#### 7.2.5.4 - `Sizes.jsx`
``` javascript
import EventEmitter from './EventEmitter';

export default class Sizes extends EventEmitter
{
    constructor()
    {
        super() // Needed for event emitter override the constructor

        // Setup
        this.width = window.innerWidth
        this.height = window.innerHeight
        this.pixelRatio = Math.min(window.devicePixelRatio, 2)

        // Resize
        window.addEventListener('resize', () =>
        {
            this.width = window.innerWidth
            this.height = window.innerHeight
            this.pixelRatio = Math.max(window.devicePixelRatio, 2)

            this.trigger('resize')  // Trigger 'resize' when the event occur
        })
    }
}
```

#### 7.2.5.5 - `Time.jsx`
``` javascript
import EventEmitter from "./EventEmitter"

export default class Time extends EventEmitter
{
    constructor()
    {
        super()

        // Setup
        this.start = Date.now()
        this.current = this.start
        this.elapsed = 0
        this.delta = 16

        window.requestAnimationFrame(() => 
        {
            this.tick()
        })
    }

    tick()
    {
        const currentTime = Date.now()
        
        this.delta = currentTime - this.current
        this.current = currentTime
        this.elapsed = this.current - this.start

        this.trigger('tick')

        window.requestAnimationFrame(() => 
        {
            this.tick()
        })
    }
}
```

### 7.2.6 - `/World`

#### 7.2.6.1 - `Environment.jsx`

``` javascript
import * as THREE from 'three'

import Application from "../Application";

export default class Environment
{
    constructor()
    {
        this.application = new Application();
        this.scene = this.application.scene
        this.resources = this.application.resources
        this.debug = this.application.debug

        // Debug Folder
        if(this.debug.active)
        {
            this.debugFolder = this.debug.ui.addFolder('Environment')
        }

        // Setup
        this.setSunLight()
        this.setEnvironmentMap()
    }

    setSunLight()
    {
        this.sunLight = new THREE.DirectionalLight('#ffffff', 4)
        this.sunLight.castShadow = true
        this.sunLight.shadow.camera.far = 15
        this.sunLight.shadow.mapSize.set(1024, 1024)
        this.sunLight.shadow.normalBias = 0.05
        this.sunLight.position.set(3.5, 2, - 1.25)
        this.scene.add(this.sunLight)

        // Debug
        if(this.debug.active)
        {
            this.debugFolder
                .add(this.sunLight, 'intensity')
                .name('sunLightIntensity')
                .min(0)
                .max(10)
                .step(0.001)

            this.debugFolder
                .add(this.sunLight.position, 'x')
                .name('sunLightPositionX')
                .min(-10)
                .max(10)
                .step(0.001)
            
            this.debugFolder
                .add(this.sunLight.position, 'y')
                .name('sunLightPositionY')
                .min(-10)
                .max(10)
                .step(0.001)
            
            this.debugFolder
                .add(this.sunLight.position, 'z')
                .name('sunLightPositionZ')
                .min(-10)
                .max(10)
                .step(0.001)
        }
    }

    setEnvironmentMap()
    {
        this.environmentMap = {}
        this.environmentMap.intensity = 0.4
        this.environmentMap.texture = this.resources.items.environmentMapTexture
        this.environmentMap.texture.colorSpace = THREE.SRGBColorSpace
        
        this.scene.environment = this.environmentMap.texture

        this.environmentMap.updateMaterials = () =>
        {
            // Apply environmentMap to all objects in the scene
            this.scene.traverse((child) =>
            {
                if(child instanceof THREE.Mesh && child.material instanceof THREE.MeshStandardMaterial)
                {
                    child.material.envMap = this.environmentMap.texture
                    child.material.envMapIntensity = this.environmentMap.intensity
                    child.material.needsUpdate = true
                }
            })
        }
        this.environmentMap.updateMaterials()

        // Debug
        if(this.debug.active)
        {
            this.debugFolder
                .add(this.environmentMap, 'intensity')
                .name('envMapIntensity')
                .min(0)
                .max(4)
                .step(0.001)
                .onChange(this.environmentMap.updateMaterials)
        }
    }
}
```

#### 7.2.6.2 - `Floor.jsx`
``` javascript
import * as THREE from 'three'

import Application from "../Application";

export default class Floor
{
    constructor()
    {
        this.application = new Application()
        this.scene = this.application.scene
        this.resources = this.application.resources

        // Setup
        this.setGeometry()
        this.setTexture()
        this.setMaterial()
        this.setMesh()
    }

    setGeometry()
    {
        this.geometry = new THREE.CircleGeometry(5, 64)
    }

    setTexture()
    {
        this.textures = {}

        this.textures.color = this.resources.items.grassColorTexture
        this.textures.color.colorSpace = THREE.SRGBColorSpace
        this.textures.color.wrapS = THREE.RepeatWrapping
        this.textures.color.wrapT = THREE.RepeatWrapping
        this.textures.color.repeat.set([1.5, 1.5])

        this.textures.normal = this.resources.items.grassNormalTexture
        this.textures.normal.repeat.set(1.5, 1.5)
        this.textures.normal.wrapS = THREE.RepeatWrapping
        this.textures.normal.wrapT = THREE.RepeatWrapping


    }

    setMaterial()
    {
        this.material = new THREE.MeshStandardMaterial({
            map: this.textures.color,
            normalMap: this.textures.normal
        })
    }

    setMesh()
    {
        this.mesh = new THREE.Mesh(this.geometry, this.material)
        this.mesh.rotation.x = - Math.PI * 0.5
        this.mesh.receiveShadow = true

        this.scene.add(this.mesh)
    }
}
```

#### 7.2.6.3 - `Fox.jsx`
``` javascript
import * as THREE from 'three'
import Application from '../Application.js'

export default class Fox
{
    constructor()
    {
        this.application = new Application()
        this.scene = this.application.scene
        this.resources = this.application.resources
        this.time = this.application.time
        this.debug = this.application.debug

        // Debug Folder
        if(this.debug.active)
        {
            this.debugFolder = this.debug.ui.addFolder('Fox')
        }

        // Setuo
        this.resource = this.resources.items.foxModel

        this.setModel()
        this.setAnimation()
    }

    setModel()
    {
        this.model = this.resource.scene
        this.model.scale.set(0.02, 0.02, 0.02)
        this.scene.add(this.model)

        this.model.traverse((child) =>
        {
            if(child instanceof THREE.Mesh)
            {
                child.castShadow = true
            }
        })
    }

    setAnimation()
    {
        this.animation = {}
        
        // Mixer
        this.animation.mixer = new THREE.AnimationMixer(this.model)
        
        // Actions
        this.animation.actions = {}
        
        this.animation.actions.idle = this.animation.mixer.clipAction(this.resource.animations[0])
        this.animation.actions.walking = this.animation.mixer.clipAction(this.resource.animations[1])
        this.animation.actions.running = this.animation.mixer.clipAction(this.resource.animations[2])
        
        this.animation.actions.current = this.animation.actions.idle
        this.animation.actions.current.play()

        // Play the action
        this.animation.play = (name) =>
        {
            const newAction = this.animation.actions[name]
            const oldAction = this.animation.actions.current

            newAction.reset()
            newAction.play()
            newAction.crossFadeFrom(oldAction, 1)

            this.animation.actions.current = newAction
        }

        // Debug
        if(this.debug.active)
        {
            const debugObject = {
                playIdle: () => { this.animation.play('idle') },
                playWalking: () => { this.animation.play('walking') },
                playRunning: () => { this.animation.play('running') },
            }
            this.debugFolder.add(debugObject, 'playIdle')
            this.debugFolder.add(debugObject, 'playWalking')
            this.debugFolder.add(debugObject, 'playRunning')
        }
    }

    update()
    {
        this.animation.mixer.update(this.time.delta * 0.001)
    }
}
```

#### 7.2.6.4 - `World.jsx`
``` javascript
import Application from "../Application.js";
import Environment from './Environment.js';
import Floor from './Floor.js';
import Fox from './Fox.js';

export default class World
{
    constructor()
    {
        this.application = new Application();
        this.scene = this.application.scene
        this.resources = this.application.resources

        // Waiting for the resources to load
        this.resources.on('resourcesLoaded', () =>
        {
            // Setup
            this.floor = new Floor()
            this.fox = new Fox()
            this.environment = new Environment()
        })
    }

    update()
    {
        if(this.fox)
            this.fox.update()
    }
}
```

------

# 8 - Shaders

1. [Basics](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#81---basics)
2. [Shader Patterns](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#82---shader-patterns)
3. [Modified Materials](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#83---modified-materials)

[Perlin Noise Templates](https://gist.github.com/patriciogonzalezvivo/670c22f3966e662d2f83)

## 8.1 - Basics

1. [Description](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#811---description)
2. [Documentation](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#812---documentation)
3. [Shader Material](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#813---shader-material)
4. [Vertex Shader](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#814---vertex-shader)
5. [Fragment Shader](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#815---fragment-shader)
6. [Vertex and Fragment Shader](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#816---vertex-and-fragment-shader)
7. [ShaderMaterial](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#817---shadermaterial)
8. [More information about Shaders](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#818---more-information-about-shaders)
9. [Implementation](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#819---implementation)

### 8.1.1 - Description

A material rendered with custom shaders. A shader is a small program written in `GLSL` that runs on the GPU. Calculate which pixels are visible in the scene.

Data sent to the shader:

* Vertices coordinates
* Mesh transformation
* Information about the camera
* Colors
* Textures
* Lights
* Fog
* Etc

Types of shaders:

* `vertex shader` position the vertices on the render
* `fragment shader` color each visible fragment (or pixel) of that geometry
* `frament shader` is executed after the `vertex shader`
* Changes between each vertices (like positions) are called attributes and can only be used in the vertex shader


* Custom shaders can be very simple and performant
* Custom post-processing

### 8.1.2 - Documentation

* [Shaderific](https://shaderific.com/glsl.html)
* [Kronos group](https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/indexflat.php)
* [Book of Shaders](https://thebookofshaders.com/)

``` bash
npm install vite-plugin-glsl
```

### 8.1.3 - Shader Material

`ShaderMaterial` - Code preset

`RawShaderMaterial` - Nothing inside


### 8.1.4 - Vertex Shader

`projectionMatrix` - Transform coordinates into the clip space coordinates
`viewMatrix` - Apply transformations relative to the `camera` (position, rotation, field of view, near and far)
`modelMatrix` - Apply transformations relative to the `Mesh` (position, rotation and scale)


`gl_Position` - Is a variable that already exists, contain the position of the vertex on the screen


### 8.1.5 - Fragment Shader

`precision` - Decides how precise can a float be (`highp`, `mediump`, `lowp`)

`gl_FragColor` - Is a variable that already exists, contain the color of the fragment

### 8.1.6 - Vertex and Fragment Shader

Can be used in Vertex and Fragment shaders

`uniforms` - Same shader but different results, tweak values easly and 
animate values

### 8.1.7 - ShaderMaterial

pre-built uniforms, we can remove this variables:

* uniform mat4 projectionMatrix
* uniform mat4 viewMatrix
* uniform mat4 modelMatrix
* attribute vec3 position
* attribute vec2 uv
* precision mediump float

### 8.1.8 - More information about Shaders

* [The Book of Shaders](https://thebookofshaders.com/)
* [ShaderToy](https://www.shadertoy.com/)
* [The Art of Code](https://www.youtube.com/channel/UCcAlTqd9zID6aNX3TzwxJXg)
* [Lewis Lepton](https://www.youtube.com/channel/UC8Wzk_R1GoPkPqLo-obU_kQ)

### 8.1.9 - Implementation

`vite.config.js`

``` javascript
import glsl from 'vite-plugin-glsl'

export default {

    //(...)
    ,
    plugins:
    [
        glsl()
    ]
}
```

`script.js`

``` javascript
import testVertexShader from './shaders/test/vertex.glsl'
import testFragmentShader from './shaders/test/fragment.glsl'

/**
 * Textures
 */
const textureLoader = new THREE.TextureLoader()
const flagTexture = textureLoader.load('/textures/flag-french.jpg')

/**
 * Test mesh
 */
// Geometry
const geometry = new THREE.PlaneGeometry(1, 1, 32, 32)

const count = geometry.attributes.position.count
const randoms = new Float32Array(count)

for(let i = 0; i < count; i++)
{
    randoms[i] = Math.random()
}

// attribute to be retrieved in the shader
geometry.setAttribute('aRandom', new THREE.BufferAttribute(randoms, 1))

// Material
const material = new THREE.ShaderMaterial({
    vertexShader: testVertexShader,
    fragmentShader: testFragmentShader,
    //side: THREE.DoubleSide,
    transparent: true,
    //wireframe: true
    uniforms: {
        uFrequency: { value: new THREE.Vector2(10, 5) },
        uTime: { value: 0 },
        uColor: { value: new THREE.Color('cyan') },
        uTexture: { value: flagTexture }
    }
})

// GUI
gui.add(material.uniforms.uFrequency.value, 'x')
    .min(0)
    .max(20)
    .step(0.001)
    .name('Frequency - X')

gui.add(material.uniforms.uFrequency.value, 'y')
    .min(0)
    .max(20)
    .step(0.001)
    .name('Frequency - Y')

// Mesh
const mesh = new THREE.Mesh(geometry, material)
mesh.scale.y = 2 / 3
scene.add(mesh)

/**
 * Animate
 */
const clock = new THREE.Clock()

const tick = () =>
{
    const elapsedTime = clock.getElapsedTime()

    // Update uniform variable
    material.uniforms.uTime.value = elapsedTime

    // (...)
}

tick()
```

`vertex.glsl`

``` c
//uniform mat4 projectionMatrix;
//uniform mat4 viewMatrix;
//uniform mat4 modelMatrix;
uniform vec2 uFrequency;
uniform float uTime;

//attribute vec3 position;
attribute float aRandom;

//attribute vec2 uv;

varying vec2 vUv;
varying float vElevation;

// Canot import aRandom in the fragment.glsl but we can send through vertex
//varying float vRandom;
/*
float functionExample(float f)
{
    float d = 1.2;

    return d + f;
}

void functionVoidExample()
{
    float d = 1.2;
    float f = 2.3;
}
*/
void main()
{
    /*
    vRandom = aRandom;

    vec2 vec2D = vec2(1.2, 2.0);
    vec2D *= 2.0;

    vec3 vec3D = vec3(1.2, 2.0, 3.3);

    vec3D.x = 2.2;
    vec3D.y = 1.2;
    vec3D.z = 3.0;

    vec3D.r = 2.2;
    vec3D.g = 1.2;
    vec3D.z = 3.0;

    vec3 vec3D2 = vec3(vec2D, 3.3);
    vec2 vec2D3 = vec3D.xy;

    vec4 vec4D = vec4(1.2, 2.0, 3.3, 4.4);

    float a = 1.12;
    float functResult = functionExample(a);
    */

    vUv = uv;

    vec4 modelPosition = modelMatrix * vec4(position, 1.0);
    float elevation = sin(modelPosition.x * uFrequency.x - uTime) * 0.1;
    elevation += sin(modelPosition.y * uFrequency.y - uTime) * 0.1;

    modelPosition.z = elevation;
    vElevation = elevation;

    // Get attribute from script.js
    //modelPosition.z += aRandom * 0.1;
    vec4 viewPosition = viewMatrix * modelPosition;
    vec4 projectedPosition = projectionMatrix * viewPosition;

    gl_Position = projectedPosition;
}
```

`fragment.glsl`

``` c
//precision mediump float;
//uniform vec3 uColor;
uniform sampler2D uTexture; // sampler for textures

varying vec2 vUv;
varying float vElevation;

// Variable sent through vertex.glsl
//varying float vRandom;

void main()
{   
    // gl_FragColor = vec4(0.5, vRandom, 1.0, 1.0);
    vec4 textureColor = texture2D(uTexture, vUv);
    textureColor.rgb *= vElevation * 1.3 + 0.8; // Simulate shadows
    gl_FragColor = textureColor;
}
```

## 8.2 - Shader Patterns

1. [Normal pattern](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#821---normal-pattern)
2. [Normal pattern alternative](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#822---normal-pattern-alternative)
3. [Simple Grey gradient](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#823---simple-grey-gradient)
4. [Rotated Grey gradient](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#824---rotated-grey-gradient)
5. [Inverted Grey gradient](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#825---inverted-grey-gradient)
6. [Grey gradient but with more white](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#826---grey-gradient-but-with-more-white)
7. [Grey gradient repeating like roof tiles](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#827---grey-gradient-repeating-like-roof-tiles)
8. [Grey gradient repeating like roof tiles but more black space between tiles](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#828---grey-gradient-repeating-like-roof-tiles-but-more-black-space-between-tiles)
9. [Grey gradient repeating like roof tiles but more black space between tiles than pattern 8](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#829---grey-gradient-repeating-like-roof-tiles-but-more-black-space-between-tiles-than-pattern-8)
10. [Rotate last pattern](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8210---rotate-last-pattern)
11. [Patern 9 and 10 added together to make multiple squares](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8211---patern-9-and-10-added-together-to-make-multiple-squares)
12. [Inverted 11 pattern, dots](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8212---inverted-11-pattern-dots)
13. [Make the dots rectangles](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8213---make-the-dots-rectangles)
14. [Mix with 13 and 13 in other axis](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8214---mix-with-13-and-13-in-other-axis)
15. [Cross pattern with previous bars](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8215---cross-pattern-with-previous-bars)
16. [Double vertical grey gradient](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8216---double-vertical-grey-gradient)
17. [4 Gradients in square with cross in the middle](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8217---4-gradients-in-square-with-cross-in-the-middle)
18. [4 Gradients in triangles making a X](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8218---4-gradients-in-triangles-making-a-x)
19. [Square with empty square inside](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8219---square-with-empty-square-inside)
20. [Square with bigger empty square inside](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8220---square-with-bigger-empty-square-inside)
21. [Color palette of 10 grey colors](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8221---color-palette-of-10-grey-colors)
22. [Color palette of 10*10 grey colors](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8222---color-palette-of-1010-grey-colors)
23. [Old tv pixels without channel using Random function](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8223---old-tv-pixels-without-channel-using-random-function)
24. [Old tv pixels with bigger pixel size, sent the vec2 to random](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8224---old-tv-pixels-with-bigger-pixel-size-sent-the-vec2-to-random)
25. [Old tv pixels with bigger pixel size offset (rotated and stretched)](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8225---old-tv-pixels-with-bigger-pixel-size-offset-rotated-and-stretched)
26. [Corner gradient](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8226---corner-gradient)
27. [Center gradient](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8227---center-gradient)
28. [Center gradient but white in the center](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8228---center-gradient-but-white-in-the-center)
29. [Center gradient but small white like a sun](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8229---center-gradient-but-small-white-like-a-sun)
30. [Same as 29 but stretch, elipse sun](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8230---same-as-30-but-stretch-elipse-sun)
31. [Star](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8231---star)
32. [Rotated Star using function](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8232---rotated-star-using-function)
33. [Square empty circle in the middle](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8233---square-empty-circle-in-the-middle)
34. [Eclipse with gradient inside and outside](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8234---eclipse-with-gradient-inside-and-outside)
35. [Empty Circle](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8235---empty-circle)
36. [Circle](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8236---circle)
37. [Elastic (Circle with waves)](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8237---elastic-circle-with-waves)
38. [Elastic with X (makes some particles)](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8238---elastic-with-x-makes-some-particles)
39. [Complex, like a CPU connector](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8239---complex-like-a-cpu-connector)
40. [Complex, like a CPU connector](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8240---complex-like-a-cpu-connector)
41. [45 % angle gradient](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8241---45--angle-gradient)
42. [45% angle gradient and screen cuted in the middle](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8242---45-angle-gradient-and-screen-cuted-in-the-middle)
43. [45% gradient like a clock](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8243---45-gradient-like-a-clock)
44. [Illusion with 20 triangles](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8244---illusion-with-20-triangles)
45. [Illusion with 20 triangles and bigger dark space](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8245---illusion-with-20-triangles)
46. [Waving circle](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8246---waving-circle)
47. [Perlin Noise - Clouds, Water, Fire, Terrain, Elevation and to animate Grass and Snow (Nature Algorithm)](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8247---perlin-noise---clouds-water-fire-terrain-elevation-and)
48. [Camouflage](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8247---perlin-noise---clouds-water-fire-terrain-elevation-and)
49. [Neon Camouflage](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8249---neon-camouflage)
50. [Celular ( random elastic Circles inside circles)](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8250---celular--random-elastic-circles-inside-circles)
51. [Color application in the Pattern](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#8251---color-application-in-the-pattern)

`fragment.glsl`

### 8.2.1 - Normal pattern

``` c
void main()
{
    gl_FragColor = vec4(vUv, 1.0, 1.0);
}
```

### 8.2.2 - Normal pattern alternative

``` c
void main()
{
    gl_FragColor = vec4(vUv, 0.5, 1.0);
}
```

### 8.2.3 - Simple Grey gradient  

``` c
void main()
{
    float strength = vUv.x;

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```

### 8.2.4 - Rotated Grey gradient 

``` c
void main()
{
    float strength = vUv.y;

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```

### 8.2.5 - Inverted Grey gradient

``` c
void main()
{
    float strength = 1.0 - vUv.y;

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```

### 8.2.6 - Grey gradient but with more white

``` c
void main()
{
    float strength = vUv.y * 10.0;

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```

### 8.2.7 - Grey gradient repeating like roof tiles

``` c
void main()
{
    float strength = mod(vUv.y * 10.0, 1.0);

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```

### 8.2.8 - Grey gradient repeating like roof tiles but more black space between tiles

``` c
void main()
{
    float strength = mod(vUv.y * 10.0, 1.0);
    strength = step(0.5, strength);

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```

### 8.2.9 - Grey gradient repeating like roof tiles but more black space between tiles than pattern 8

``` c
void main()
{
    float strength = mod(vUv.y * 10.0, 1.0);
    strength = step(0.8, strength);

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```

### 8.2.10 - Rotate last pattern

``` c
void main()
{
    float strength = mod(vUv.x * 10.0, 1.0);
    strength = step(0.8, strength);

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```
### 8.2.11 - Patern 9 and 10 added together to make multiple squares

``` c
void main()
{
    float strength = step(0.8, mod(vUv.x * 10.0, 1.0));
    strength += step(0.8, mod(vUv.y * 10.0, 1.0));

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```

### 8.2.12 - Inverted 11 pattern, dots

``` c
void main()
{
    float strength = step(0.8, mod(vUv.x * 10.0, 1.0));
    strength *= step(0.8, mod(vUv.y * 10.0, 1.0));

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```

### 8.2.13 - Make the dots rectangles

``` c
void main()
{
    float strength = step(0.4, mod(vUv.x * 10.0, 1.0));
    strength *= step(0.8, mod(vUv.y * 10.0, 1.0));

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```

### 8.2.14 - Mix with 13 and 13 in other axis

``` c
void main()
{
    float barX = step(0.4, mod(vUv.x * 10.0, 1.0));
    barX *= step(0.8, mod(vUv.y * 10.0, 1.0));

    float barY = step(0.8, mod(vUv.x * 10.0, 1.0));
    barY *= step(0.4, mod(vUv.y * 10.0, 1.0));

    float strength = barX + barY;

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```

### 8.2.15 - Cross pattern with previous bars

``` c
void main()
{
    float barX = step(0.4, mod(vUv.x * 10.0, 1.0));     // thickness 0.4 so + 0.2 to center
    barX *= step(0.8, mod(vUv.y * 10.0 + 0.2, 1.0));

    float barY = step(0.8, mod(vUv.x * 10.0 + 0.2, 1.0));
    barY *= step(0.4, mod(vUv.y * 10.0, 1.0));

    float strength = barX + barY;

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```
### 8.2.16 - Double vertical grey gradient

``` c
void main()
{
    float strength = abs(vUv.x - 0.5);

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```

### 8.2.17 - 4 Gradients in square with cross in the middle
``` c
void main()
{
    float strength = min(abs(vUv.x - 0.5), abs(vUv.y - 0.5));

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```

### 8.2.18 - 4 Gradients in triangles making a X

``` c
void main()
{
    float strength = max(abs(vUv.x - 0.5), abs(vUv.y - 0.5));


    gl_FragColor = vec4(vec3(strength), 1.0);
}
```

### 8.2.19 - Square with empty square inside

``` c
void main()
{
    float strength = step(0.2, max(abs(vUv.x - 0.5), abs(vUv.y - 0.5)));


    gl_FragColor = vec4(vec3(strength), 1.0);
}
```

### 8.2.20 - Square with bigger empty square inside

``` c
void main()
{
    float strength = step(0.4, max(abs(vUv.x - 0.5), abs(vUv.y - 0.5)));

    // Oposite pattern, we can combine with *
    float strength = 1.0 - step(0.4, max(abs(vUv.x - 0.5), abs(vUv.y - 0.5)));


    gl_FragColor = vec4(vec3(strength), 1.0);
}
```
### 8.2.21 - Color palette of 10 grey colors

``` c
void main()
{
    float strength = floor(vUv.x * 10.0) / 10.0;

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```

### 8.2.22 - Color palette of 10*10 grey colors

``` c
void main()
{
    float hBars = floor(vUv.x * 10.0) / 10.0;
    float vBars = floor(vUv.y * 10.0) / 10.0; 

    float strength = hBars * vBars; // * to combine

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```

### 8.2.23 - Old tv pixels without channel using Random function

``` c
// Random function
float random(vec2 st)
{
    return fract(sin(dot(st.xy, vec2(12.9898, 78.233))) * 43758.5453123);
}

void main()
{
    float strength = random(vUv);

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```

### 8.2.24 - Old tv pixels with bigger pixel size, sent the vec2 to random

``` c
float random(vec2 st)
{
    return fract(sin(dot(st.xy, vec2(12.9898, 78.233))) * 43758.5453123);
}

void main()
{
    float gridUv = random(vUv);

    vec2 gridUv = vec2(
        floor(vUv.x * 10.0) / 10.0,
        floor(vUv.y * 10.0) / 10.0
    );

    gl_FragColor = vec4(vec3(gridUv), 1.0);
}
```

### 8.2.25 - Old tv pixels with bigger pixel size offset (rotated and stretched)

``` c
void main()
{
    vec2 gridUv = vec2(
        floor(vUv.x * 10.0) / 10.0,
        floor((vUv.y + vUv.x * 0.5) * 10.0) / 10.0
    );

    gl_FragColor = vec4(vec3(gridUv), 1.0);
}
```
### 8.2.26 - Corner gradient 
``` c
void main()
{
    float strength = length(vUv);

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```

### 8.2.27 - Center gradient 
``` c
void main()
{
    float strength = length(vUv - 0.5);
    // or
    float strength = distance(vUv, vec2(0.5, 0.5)); // can controll the center

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```

### 8.2.28 - Center gradient but white in the center

``` c
void main()
{
    float strength = 1.0 - (distance(vUv, vec2(0.5, 0.5))) * 0.8;

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```

### 8.2.29 - Center gradient but small white like a sun

``` c
void main()
{
    float strength = 0.015 / distance(vUv, vec2(0.5, 0.5));

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```

### 8.2.30 - Same as 30 but stretch, elipse sun

``` c
void main()
{
    vec2 lightUv = vec2(
        vUv.x * 0.1 + 0.45,
        vUv.y * 0.5 + 0.25
    );
    float strength = 0.015 / distance(lightUv, vec2(0.5, 0.5));

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```
### 8.2.31 - Star

``` c
void main()
{
    vec2 lightUvX = vec2(
        vUv.x * 0.1 + 0.45,
        vUv.y * 0.5 + 0.25
    );
    float lightX = 0.015 / distance(lightUvX, vec2(0.5, 0.5));

    vec2 lightUvY = vec2(
        vUv.y * 0.1 + 0.45,
        vUv.x * 0.5 + 0.25
    );
    float lightY = 0.015 / distance(lightUvY, vec2(0.5, 0.5));

    float strength = lightX * lightY;

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```

### 8.2.32 - Rotated Star using function

``` c
// Rotate function
vec2 rotate(vec2 uv, float rotation, vec2 mid)
{
    return vec2(
        cos(rotation) * (uv.x - mid.x) + sin(rotation) * (uv.y - mid.y) + mid.x,
        cos(rotation) * (uv.y - mid.y) - sin(rotation) * (uv.x - mid.x) + mid.y
    );
}

void main()
{
    vec2 rotatedUv = rotate(vUv, PI * 0.25, vec2(0.5));    // UVCoordinates, Angle, X, Y

    vec2 lightUvX = vec2(
        rotatedUv.x * 0.1 + 0.45,
        rotatedUv.y * 0.5 + 0.25
    );
    float lightX = 0.015 / distance(lightUvX, vec2(0.5));

    vec2 lightUvY = vec2(
        rotatedUv.y * 0.1 + 0.45,
        rotatedUv.x * 0.5 + 0.25
    );
    float lightY = 0.015 / distance(lightUvY, vec2(0.5));

    float strength = lightX * lightY;

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```

### 8.2.33 - Square empty circle in the middle

``` c
void main()
{
    float strength = step(0.25, distance(vUv, vec2(0.5)));

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```

### 8.2.34 - Eclipse with gradient inside and outside

``` c
void main()
{
    float strength = abs(distance(vUv, vec2(0.5)) - 0.25);

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```

### 8.2.35 - Empty Circle

``` c
void main()
{
    float strength = step(0.01, abs(distance(vUv, vec2(0.5)) - 0.25));

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```
### 8.2.36 - Circle

``` c
void main()
{
    float strength = 1.0 - step(0.01, abs(distance(vUv, vec2(0.5)) - 0.25));

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```

### 8.2.37 - Elastic (Circle with waves)

``` c
void main()
{
    vec2 waveUv = vec2(
        vUv.x,
        vUv.y + sin(vUv.x * 35.0) * 0.1      35 Frequency
    );

    float strength = 1.0 - step(0.01, abs(distance(waveUv, vec2(0.5)) - 0.25));

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```

### 8.2.38 - Elastic with X (makes some particles)

``` c
void main()
{
    vec2 waveUv = vec2(
        vUv.x + sin(vUv.y * 35.0) * 0.1,
        vUv.y + sin(vUv.x * 35.0) * 0.1      // 35 Frequency
    );

    float strength = 1.0 - step(0.01, abs(distance(waveUv, vec2(0.5)) - 0.25));

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```

### 8.2.39 - Complex, like a CPU connector

``` c
void main()
{
    vec2 waveUv = vec2(
        vUv.x + sin(vUv.y * 300.0) * 0.1,
        vUv.y + sin(vUv.x * 300.0) * 0.1     // 35 Frequency
    );

    float strength = 1.0 - step(0.01, abs(distance(waveUv, vec2(0.5)) - 0.25));

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```

### 8.2.40 - Complex, like a CPU connector

``` c
void main()
{
    vec2 waveUv = vec2(
        vUv.x + sin(vUv.y * 300.0) * 0.1,
        vUv.y + sin(vUv.x * 300.0) * 0.1     // 35 Frequency
    );

    float strength = 1.0 - step(0.01, abs(distance(waveUv, vec2(0.5)) - 0.25));

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```
### 8.2.41 - 45 % angle gradient

``` c
void main()
{
    float angle = atan(vUv.x, vUv.y);
    float strength = angle;

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```

### 8.2.42 - 45% angle gradient and screen cuted in the middle

``` c
void main()
{
    float angle = atan(vUv.x - 0.5, vUv.y - 0.5);
    float strength = angle;

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```

### 8.2.43 - 45% gradient like a clock

``` c
void main()
{
    float angle = atan(vUv.x - 0.5, vUv.y - 0.5);
    angle /= PI * 2.0;
    angle += 0.5;
    float strength = angle;

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```

### 8.2.44 - Illusion with 20 triangles

``` c
void main()
{
    float angle = atan(vUv.x - 0.5, vUv.y - 0.5);
    angle /= PI * 2.0;
    angle += 0.5;
    angle *= 20.0;  // reach 1 faster
    angle = mod(angle, 1.0); // jumps when reach 1 and repeat the texture
    float strength = angle;

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```

### 8.2.45 - Illusion with 20 triangles and bigger darker space

``` c
void main()
{
    float angle = atan(vUv.x - 0.5, vUv.y - 0.5);
    angle /= PI * 2.0;
    angle += 0.5;
    float strength = sin(angle * 100.0);

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```
### 8.2.46 - Waving circle

``` c
void main()
{
    float angle = atan(vUv.x - 0.5, vUv.y - 0.5);
    angle /= PI * 2.0;
    angle += 0.5;
    float sinusoid = sin(angle * 100.0);   // 100.0 is the Frequency of the waves
    float radius = 0.25 + sinusoid * 0.02; // 0.02 is the Intensity of the waves

    float strength = 1.0 - step(0.01, abs(distance(vUv, vec2(0.5)) - radius));

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```

### 8.2.47 - Perlin Noise - Clouds, Water, Fire, Terrain, Elevation and

[Noise Templates](https://gist.github.com/patriciogonzalezvivo/670c22f3966e662d2f83)

``` c
vec4 permute(vec4 x)
{
    return mod(((x * 34.0) + 1.0) * x, 289.0);
}

// Noise Template
//	Classic Perlin 2D Noise 
//	by Stefan Gustavson
//
vec2 fade(vec2 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}

float cnoise(vec2 P){
  vec4 Pi = floor(P.xyxy) + vec4(0.0, 0.0, 1.0, 1.0);
  vec4 Pf = fract(P.xyxy) - vec4(0.0, 0.0, 1.0, 1.0);
  Pi = mod(Pi, 289.0); // To avoid truncation effects in permutation
  vec4 ix = Pi.xzxz;
  vec4 iy = Pi.yyww;
  vec4 fx = Pf.xzxz;
  vec4 fy = Pf.yyww;
  vec4 i = permute(permute(ix) + iy);
  vec4 gx = 2.0 * fract(i * 0.0243902439) - 1.0; // 1/41 = 0.024...
  vec4 gy = abs(gx) - 0.5;
  vec4 tx = floor(gx + 0.5);
  gx = gx - tx;
  vec2 g00 = vec2(gx.x,gy.x);
  vec2 g10 = vec2(gx.y,gy.y);
  vec2 g01 = vec2(gx.z,gy.z);
  vec2 g11 = vec2(gx.w,gy.w);
  vec4 norm = 1.79284291400159 - 0.85373472095314 * 
    vec4(dot(g00, g00), dot(g01, g01), dot(g10, g10), dot(g11, g11));
  g00 *= norm.x;
  g01 *= norm.y;
  g10 *= norm.z;
  g11 *= norm.w;
  float n00 = dot(g00, vec2(fx.x, fy.x));
  float n10 = dot(g10, vec2(fx.y, fy.y));
  float n01 = dot(g01, vec2(fx.z, fy.z));
  float n11 = dot(g11, vec2(fx.w, fy.w));
  vec2 fade_xy = fade(Pf.xy);
  vec2 n_x = mix(vec2(n00, n01), vec2(n10, n11), fade_xy.x);
  float n_xy = mix(n_x.x, n_x.y, fade_xy.y);
  return 2.3 * n_xy;
}

void main()
{
    float strength = cnoise(vUv * 20.0);

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```

### 8.2.48 - Camouflage

``` c
vec4 permute(vec4 x)
{
    return mod(((x * 34.0) + 1.0) * x, 289.0);
}

// Noise Template
//	Classic Perlin 2D Noise 
//	by Stefan Gustavson
//
vec2 fade(vec2 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}

float cnoise(vec2 P){
  vec4 Pi = floor(P.xyxy) + vec4(0.0, 0.0, 1.0, 1.0);
  vec4 Pf = fract(P.xyxy) - vec4(0.0, 0.0, 1.0, 1.0);
  Pi = mod(Pi, 289.0); // To avoid truncation effects in permutation
  vec4 ix = Pi.xzxz;
  vec4 iy = Pi.yyww;
  vec4 fx = Pf.xzxz;
  vec4 fy = Pf.yyww;
  vec4 i = permute(permute(ix) + iy);
  vec4 gx = 2.0 * fract(i * 0.0243902439) - 1.0; // 1/41 = 0.024...
  vec4 gy = abs(gx) - 0.5;
  vec4 tx = floor(gx + 0.5);
  gx = gx - tx;
  vec2 g00 = vec2(gx.x,gy.x);
  vec2 g10 = vec2(gx.y,gy.y);
  vec2 g01 = vec2(gx.z,gy.z);
  vec2 g11 = vec2(gx.w,gy.w);
  vec4 norm = 1.79284291400159 - 0.85373472095314 * 
    vec4(dot(g00, g00), dot(g01, g01), dot(g10, g10), dot(g11, g11));
  g00 *= norm.x;
  g01 *= norm.y;
  g10 *= norm.z;
  g11 *= norm.w;
  float n00 = dot(g00, vec2(fx.x, fy.x));
  float n10 = dot(g10, vec2(fx.y, fy.y));
  float n01 = dot(g01, vec2(fx.z, fy.z));
  float n11 = dot(g11, vec2(fx.w, fy.w));
  vec2 fade_xy = fade(Pf.xy);
  vec2 n_x = mix(vec2(n00, n01), vec2(n10, n11), fade_xy.x);
  float n_xy = mix(n_x.x, n_x.y, fade_xy.y);
  return 2.3 * n_xy;
}

void main()
{
    float strength = step(0.1, cnoise(vUv * 10.0));

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```

### 8.2.49 - Neon Camouflage

``` c
vec4 permute(vec4 x)
{
    return mod(((x * 34.0) + 1.0) * x, 289.0);
}

// Noise Template
//	Classic Perlin 2D Noise 
//	by Stefan Gustavson
//
vec2 fade(vec2 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}

float cnoise(vec2 P){
  vec4 Pi = floor(P.xyxy) + vec4(0.0, 0.0, 1.0, 1.0);
  vec4 Pf = fract(P.xyxy) - vec4(0.0, 0.0, 1.0, 1.0);
  Pi = mod(Pi, 289.0); // To avoid truncation effects in permutation
  vec4 ix = Pi.xzxz;
  vec4 iy = Pi.yyww;
  vec4 fx = Pf.xzxz;
  vec4 fy = Pf.yyww;
  vec4 i = permute(permute(ix) + iy);
  vec4 gx = 2.0 * fract(i * 0.0243902439) - 1.0; // 1/41 = 0.024...
  vec4 gy = abs(gx) - 0.5;
  vec4 tx = floor(gx + 0.5);
  gx = gx - tx;
  vec2 g00 = vec2(gx.x,gy.x);
  vec2 g10 = vec2(gx.y,gy.y);
  vec2 g01 = vec2(gx.z,gy.z);
  vec2 g11 = vec2(gx.w,gy.w);
  vec4 norm = 1.79284291400159 - 0.85373472095314 * 
    vec4(dot(g00, g00), dot(g01, g01), dot(g10, g10), dot(g11, g11));
  g00 *= norm.x;
  g01 *= norm.y;
  g10 *= norm.z;
  g11 *= norm.w;
  float n00 = dot(g00, vec2(fx.x, fy.x));
  float n10 = dot(g10, vec2(fx.y, fy.y));
  float n01 = dot(g01, vec2(fx.z, fy.z));
  float n11 = dot(g11, vec2(fx.w, fy.w));
  vec2 fade_xy = fade(Pf.xy);
  vec2 n_x = mix(vec2(n00, n01), vec2(n10, n11), fade_xy.x);
  float n_xy = mix(n_x.x, n_x.y, fade_xy.y);
  return 2.3 * n_xy;
}

void main()
{
    float strength = 1.0 - abs(cnoise(vUv * 10.0));

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```

### 8.2.50 - Celular ( random elastic Circles inside circles)

``` c
vec4 permute(vec4 x)
{
    return mod(((x * 34.0) + 1.0) * x, 289.0);
}

// Noise Template
//	Classic Perlin 2D Noise 
//	by Stefan Gustavson
//
vec2 fade(vec2 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}

float cnoise(vec2 P){
  vec4 Pi = floor(P.xyxy) + vec4(0.0, 0.0, 1.0, 1.0);
  vec4 Pf = fract(P.xyxy) - vec4(0.0, 0.0, 1.0, 1.0);
  Pi = mod(Pi, 289.0); // To avoid truncation effects in permutation
  vec4 ix = Pi.xzxz;
  vec4 iy = Pi.yyww;
  vec4 fx = Pf.xzxz;
  vec4 fy = Pf.yyww;
  vec4 i = permute(permute(ix) + iy);
  vec4 gx = 2.0 * fract(i * 0.0243902439) - 1.0; // 1/41 = 0.024...
  vec4 gy = abs(gx) - 0.5;
  vec4 tx = floor(gx + 0.5);
  gx = gx - tx;
  vec2 g00 = vec2(gx.x,gy.x);
  vec2 g10 = vec2(gx.y,gy.y);
  vec2 g01 = vec2(gx.z,gy.z);
  vec2 g11 = vec2(gx.w,gy.w);
  vec4 norm = 1.79284291400159 - 0.85373472095314 * 
    vec4(dot(g00, g00), dot(g01, g01), dot(g10, g10), dot(g11, g11));
  g00 *= norm.x;
  g01 *= norm.y;
  g10 *= norm.z;
  g11 *= norm.w;
  float n00 = dot(g00, vec2(fx.x, fy.x));
  float n10 = dot(g10, vec2(fx.y, fy.y));
  float n01 = dot(g01, vec2(fx.z, fy.z));
  float n11 = dot(g11, vec2(fx.w, fy.w));
  vec2 fade_xy = fade(Pf.xy);
  vec2 n_x = mix(vec2(n00, n01), vec2(n10, n11), fade_xy.x);
  float n_xy = mix(n_x.x, n_x.y, fade_xy.y);
  return 2.3 * n_xy;
}

void main()
{
    float strength = step(0.9, sin(cnoise(vUv * 10.0) * 30.0));

    gl_FragColor = vec4(vec3(strength), 1.0);
}
```
### 8.2.51 - Color application in the Pattern

``` c
vec4 permute(vec4 x)
{
    return mod(((x * 34.0) + 1.0) * x, 289.0);
}

// Noise Template
//	Classic Perlin 2D Noise 
//	by Stefan Gustavson
//
vec2 fade(vec2 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}

float cnoise(vec2 P){
  vec4 Pi = floor(P.xyxy) + vec4(0.0, 0.0, 1.0, 1.0);
  vec4 Pf = fract(P.xyxy) - vec4(0.0, 0.0, 1.0, 1.0);
  Pi = mod(Pi, 289.0); // To avoid truncation effects in permutation
  vec4 ix = Pi.xzxz;
  vec4 iy = Pi.yyww;
  vec4 fx = Pf.xzxz;
  vec4 fy = Pf.yyww;
  vec4 i = permute(permute(ix) + iy);
  vec4 gx = 2.0 * fract(i * 0.0243902439) - 1.0; // 1/41 = 0.024...
  vec4 gy = abs(gx) - 0.5;
  vec4 tx = floor(gx + 0.5);
  gx = gx - tx;
  vec2 g00 = vec2(gx.x,gy.x);
  vec2 g10 = vec2(gx.y,gy.y);
  vec2 g01 = vec2(gx.z,gy.z);
  vec2 g11 = vec2(gx.w,gy.w);
  vec4 norm = 1.79284291400159 - 0.85373472095314 * 
    vec4(dot(g00, g00), dot(g01, g01), dot(g10, g10), dot(g11, g11));
  g00 *= norm.x;
  g01 *= norm.y;
  g10 *= norm.z;
  g11 *= norm.w;
  float n00 = dot(g00, vec2(fx.x, fy.x));
  float n10 = dot(g10, vec2(fx.y, fy.y));
  float n01 = dot(g01, vec2(fx.z, fy.z));
  float n11 = dot(g11, vec2(fx.w, fy.w));
  vec2 fade_xy = fade(Pf.xy);
  vec2 n_x = mix(vec2(n00, n01), vec2(n10, n11), fade_xy.x);
  float n_xy = mix(n_x.x, n_x.y, fade_xy.y);
  return 2.3 * n_xy;
}

void main()
{
    vec3 blackColor = vec3(0.0);
    vec3 uvColor = vec3(vUv, 1.0);
    float strength = step(0.9, sin(cnoise(vUv * 10.0) * 30.0));

    // Mixed color with the pattern
    vec3 mixedColor = mix(blackColor, uvColor, strength);

    strength = clamp(strength, 0.0, 1.0); // makes colors higher than 1, 1

    gl_FragColor = vec4(mixedColor, 1.0);
}
```

## 8.3 - Modified Materials

We must load the Mesh and see which Shaders it is loading, then we use the `replace` method to modify the code where we want, we can manipulate the materials in this way, we must be careful with the mapping of the shadows on the object and its surroundings and the normals .

``` javascript
const depthMaterial = new THREE.MeshDepthMaterial({
    depthPacking: THREE.RGBADepthPacking
})

const customUniforms = {
    uTime: { value: 0 }
}

material.onBeforeCompile = function(shader)
{
    console.log(shader) // To see the Vertex and Fragment shaders loaded, copy them to customize
    console.log(shader.uniforms) // To see the Vertex uniforms

    shader.uniforms.uTime = customUniforms.uTime

    shader.vertexShader = shader.vertexShader.replace(
        '#include <common>',
        `
            #include <common>

            uniform float uTime;

            mat2 get2dRotateMatrix(float _angle)
            {
                return mat2(cos(_angle), -sin(_angle), sin(_angle), cos(_angle));
            }
        `
    )

    // Fix normals
    console.log(shader)
    shader.vertexShader = shader.vertexShader.replace(
        '#include <beginnormal_vertex>',
        `
            #include <beginnormal_vertex>

            float angle = (position.y + 4.0) * sin(uTime) * 0.4;
            mat2 rotateMatrix = get2dRotateMatrix(angle);

            objectNormal.xz = objectNormal.xz * rotateMatrix;
        `
    )

    // <begin_vertex> Is handling position so we need to start replacing there
    shader.vertexShader = shader.vertexShader.replace(
        '#include <begin_vertex>',
        `
            #include <begin_vertex>

            transformed.xz = transformed.xz * rotateMatrix;
        `
    )
}

// Fix Shadows
depthMaterial.onBeforeCompile = (shader) =>
{
    shader.uniforms.uTime = customUniforms.uTime

    shader.vertexShader = shader.vertexShader.replace(
        '#include <common>',
        `
            #include <common>

            uniform float uTime;

            mat2 get2dRotateMatrix(float _angle)
            {
                return mat2(cos(_angle), -sin(_angle), sin(_angle), cos(_angle));
            }
        `
    )
    // <begin_vertex> Is handling position so we need to start replacing there
    shader.vertexShader = shader.vertexShader.replace(
        '#include <begin_vertex>',
        `
            #include <begin_vertex>

            // Twist material
            float angle = (position.y + 4.0) * sin(uTime) * 0.4;
            mat2 rotateMatrix = get2dRotateMatrix(angle);

            transformed.xz = transformed.xz * rotateMatrix;
        `
    )
}

/**
 * Models
 */
gltfLoader.load(
    '/models/LeePerrySmith/LeePerrySmith.glb',
    (gltf) =>
    {
        // (...)
        mesh.customDepthMaterial = depthMaterial
        // (...)

    }
)

/**
 * Animate
 */
const clock = new THREE.Clock()

const tick = () =>
{
    // (...)

    // Update Vertex uTime
    customUniforms.uTime.value = elapsedTime

    // (...)
}

tick()
```

------

# 9 - Post-processing

Small post-rendering modifications that can result in major changes to the final result, adding effects like:
* Depth of field
* Bloom
* God ray
* Motion blur
* Blitch effect
* Outlines
* Color variations
* Antialiasing
* Reflections and reflections
* etc

[Effects/Passes documentation](https://threejs.org/docs/index.html#examples/en/postprocessing/EffectComposer)

Import other passes to use other effects

To apply the effects and render multiple times we use the class:
`EffectComposer`

Types of Antialiasing:

* FXXA - Performant, but blurry
* SMAA - Better but less performant
* SSAA - Best quality but worst performance
* TTA - Balanced

``` javascript
import { EffectComposer } from 'three/examples/jsm/postprocessing/EffectComposer.js'
import { RenderPass } from 'three/examples/jsm/postprocessing/RenderPass.js'
import { DotScreenPass } from 'three/examples/jsm/postprocessing/DotScreenPass.js'
import { HalftonePass } from 'three/examples/jsm/postprocessing/HalftonePass.js'
import { GlitchPass } from 'three/examples/jsm/postprocessing/GlitchPass.js'
import { UnrealBloomPass } from 'three/examples/jsm/postprocessing/UnrealBloomPass.js'

// ShaderPass
import { ShaderPass } from 'three/examples/jsm/postprocessing/ShaderPass.js'
import { RGBShiftShader } from 'three/examples/jsm/shaders/RGBShiftShader.js'
import { MirrorShader } from 'three/examples/jsm/shaders/MirrorShader.js'
import { GammaCorrectionShader } from 'three/examples/jsm/shaders/GammaCorrectionShader.js'

// Antialising fix
import { SMAAPass } from 'three/examples/jsm/postprocessing/SMAAPass.js'


window.addEventListener('resize', () =>
{
    // (...)

    // Update Effect composer
    effectComposer.setPixelRatio(Math.min(window.devicePixelRatio, 2))
    effectComposer.setSize(sizes.width, sizes.height)
})

renderer.useLegacyLights = false
// renderer.outputColorSpace = THREE.SRGBColorSpace - Dont work with Shader passes
// We need to use GammaCorrectionShader to fix that instead

/**
 * Post-processing
 */
// Fix antialiasing with Shader Passes - Dont work with Safari

const renderTarget = new THREE.WebGLRenderTarget(
    800,
    600,
    {
        samples: renderer.getPixelRatio() === 1 ? 4 : 0  // renable the antialiasing
    }
)

const effectComposer = new EffectComposer(renderer, renderTarget)
effectComposer.setPixelRatio(Math.min(window.devicePixelRatio, 2))
effectComposer.setSize(sizes.width, sizes.height)

// Render without effect
const renderPass = new RenderPass(scene, camera)
effectComposer.addPass(renderPass)

// Apply effects

// Dot Screen Pass
const dotScreenPass = new DotScreenPass()
dotScreenPass.enabled = false
effectComposer.addPass(dotScreenPass)

// Glitch Pass - Control and click in the pass to see the properties
const glitchPass = new GlitchPass()
glitchPass.enabled = false
glitchPass.goWild = false
effectComposer.addPass(glitchPass)

// Unreal Bloom Pass 
const unrealBloomPass = new UnrealBloomPass()
unrealBloomPass.enabled = false
unrealBloomPass.strength = 0.3      // Glow
unrealBloomPass.radius = 1        // Speading
unrealBloomPass.treshold = 0.6      // When start to glow
effectComposer.addPass(unrealBloomPass)

// GUI Tweak
gui.add(unrealBloomPass, 'enabled')
gui.add(unrealBloomPass, 'strength').min(0).max(2).step(0.001).name('Unreal Bloom Strenght')
gui.add(unrealBloomPass, 'radius').min(0).max(2).step(0.001).name('Unreal Bloom Radius')
gui.add(unrealBloomPass, 'treshold').min(0).max(1).step(0.001).name('Unreal Bloom Treshold')

// Shader Passes

// Mirror Shader
const mirrorPass = new ShaderPass(MirrorShader)
mirrorPass.enabled = false
effectComposer.addPass(mirrorPass)

// RGB Shift Shader
const rgbShiftPass = new ShaderPass(RGBShiftShader)
rgbShiftPass.enabled = false
effectComposer.addPass(rgbShiftPass)

// sRGBEncoding not working fix with this Pass
const gammaCorrectionPass = new ShaderPass(GammaCorrectionShader)
gammaCorrectionPass.enabled = true
effectComposer.addPass(gammaCorrectionPass)

// Custom Passes

// Custom Tint
const TintShader = {
    uniforms:
    {
        tDiffuse: { value: null },
        uTint: { value: null },
    },
    vertexShader:
    `
        varying vec2 vUv;

        void main()
        {
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);

            vUv = uv;
        }
    `,
    fragmentShader:
    `
        uniform sampler2D tDiffuse;
        varying vec2 vUv;
        uniform vec3 uTint;

        void main()
        {
            vec4 color = texture2D(tDiffuse, vUv);
            color.rgb += uTint;

            gl_FragColor = color;
        }
    `
}

const tintPass = new ShaderPass(TintShader)
tintPass.material.uniforms.uTint.value = new THREE.Vector3(0, 0.1, 0.1)
tintPass.enabled = true
effectComposer.addPass(tintPass)

// Antialising fix for safari browsers
if(renderer.getPixelRatio() === 1 && !renderer.capabilities.isWebGL2)
{
    // Fix antialising in all browsers but less performant, put it after all passes
    const smaaPass = new SMAAPass()
    effectComposer.addPass(smaaPass)
    console.log("Using SMAA Antialising")
}

// GUI Tint
gui.add(tintPass.material.uniforms.uTint.value, 'x').min(-1).max(1).step(0.001).name('Tint Value Red')
gui.add(tintPass.material.uniforms.uTint.value, 'y').min(-1).max(1).step(0.001).name('Tint Value Green')
gui.add(tintPass.material.uniforms.uTint.value, 'z').min(-1).max(1).step(0.001).name('Tint Value Blue')

// Custom Displacement
const DisplacementShader = {
    uniforms:
    {
        tDiffuse: { value: null },
        uTime: { value: null }      // animate
    },
    vertexShader:
    `
        varying vec2 vUv;

        void main()
        {
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);

            vUv = uv;
        }
    `,
    fragmentShader:
    `
        uniform sampler2D tDiffuse;
        uniform float uTime;

        varying vec2 vUv;

        void main()
        {
            vec2 newUv = vec2(
                vUv.x,
                vUv.y + sin(vUv.x * 10.0 + uTime) * 0.1
            );
            vec4 color = texture2D(tDiffuse, newUv);

            gl_FragColor = color;
        }
    `
}

const displacementPass = new ShaderPass(DisplacementShader)
displacementPass.uniforms.uTime.value = 0
displacementPass.enabled = false
effectComposer.addPass(displacementPass)


// Mask - Normal texture Pass
const MaskShader = {
    uniforms:
    {
        tDiffuse: { value: null },
        uNormalMap: { value: null },
    },
    vertexShader:
    `
        varying vec2 vUv;

        void main()
        {
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);

            vUv = uv;
        }
    `,
    fragmentShader:
    `
        uniform sampler2D tDiffuse;
        uniform float uTime;
        uniform sampler2D uNormalMap;

        varying vec2 vUv;

        void main()
        {
            vec3 normalColor = texture2D(uNormalMap, vUv).xyz * 2.9 - 1.0;
            vec2 newUv = vUv + normalColor.xy * 0.1;
            vec4 color = texture2D(tDiffuse, newUv);

            vec3 lightDirection = normalize(vec3(-1.0, 1.0, 0.0));
            float lightness = clamp(dot(normalColor, lightDirection), 0.0, 1.0);
            color += lightness * 2.0;

            gl_FragColor = color;
        }
    `
}

const maskPass = new ShaderPass(MaskShader)
maskPass.material.uniforms.uNormalMap.value = textureLoader.load('/textures/interfaceNormalMap.png')
maskPass.enabled = true
effectComposer.addPass(maskPass)

/**
 * Animate
 */
const clock = new THREE.Clock()

const tick = () =>
{
    const elapsedTime = clock.getElapsedTime()

    // Update Pass
    //displacementPass.uniforms.uTime.value = elapsedTime

    // (...)
}

tick()
```


# 10 - Performance

1. [Stats](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#101---stats)
2. [Monitor Draws](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#102---monitor-drawns)
3. [Performance Tips](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#103---performance-tips)
4. [Loading and Intro](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#104---loading-and-intro)
5. [HTML and WebGL](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#105-html-and-webgl)


* Target should be 60 FPS
* Less draws, the better

## 10.1 - Stats

We will use `stats.js`

``` bash
npm install --save stats.js 
```

``` javascript
import Stats from 'stats.js'

/**
 * Performance Monitor
 */
const stats = new Stats()
stats.showPanel( 1 );
document.body.appendChild( stats.dom )

const tick = () =>
{
    stats.begin()

    // (...)

    stats.end()
}
```

## 10.2 - Monitor Drawns

Chrome extension:
* [Spectorjs](https://chrome.google.com/webstore/detail/spectorjs/denbgaamihkadbghdceggmchnflmhpmk)

With the extension, record one frame and see the order the objects are been drawn

To see what is been drawned in the renderer we can use:
```javascript
console.log(renderer.info)
```

## 10.3 - Performance Tips

1. [Geometry](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#1031---geometry)
2. [Light](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#1032---light)
3. [Shadow](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#1033---shadow)
4. [Texture](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#1034---texture)
5. [Material](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#1035---material)
6. [Mesh](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#1036---mesh)
7. [Model](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#1037---model)
8. [Camera](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#1038---camera)
9. [Renderer](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#1039---renderer)
10. [Post-processing](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#10310---post-processing)
11. [Shader](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#10311---shader)

### 10.3.1 - Geometry

* Dispose textures and materials after removing the object

``` javascript
scene.remove(cube)
cube.geometry.dispose()
cube.material.dispose()
```

* Avoid update the vertices inside animations, do vertex shaders for performance
* Use the same texture and material in the object if possible
* We can merge geometries to been drawn at the same time

``` javascript
import * as BufferGeometryUtils from 'three/examples/jsm/utils/BufferGeometryUtils.js'

const geometries = []

for(let i = 0; i < 50; i++)
{
    const geometry = new THREE.BoxGeometry(0.5, 0.5, 0.5)

    geometry.translate(
        (Math.random() - 0.5) * 10,
        (Math.random() - 0.5) * 10,
        (Math.random() - 0.5) * 10,
    )

    geometry.rotateX((Math.random() - 0.5) * Math.PI * 2)
    geometry.rotateY((Math.random() - 0.5) * Math.PI * 2)

    geometries.push(geometry)
}

const mergedGeometries = BufferGeometryUtils.mergeGeometries(geometries)

const material = new THREE.MeshNormalMaterial()

const mesh = new THREE.Mesh(mergedGeometries, material)
mesh.position.x = (Math.random() - 0.5) * 10
mesh.position.y = (Math.random() - 0.5) * 10
mesh.position.z = (Math.random() - 0.5) * 10
mesh.rotation.x = (Math.random() - 0.5) * Math.PI * 2
mesh.rotation.y = (Math.random() - 0.5) * Math.PI * 2

scene.add(mesh)
```


### 10.3.2 - Light

* Avoid Lights
* Use cheap lights like AmbientLight DirectionalLight or HemisphereLight
* Bake the lights in the texture
* Avoid adding and removing lights, all the materials will be recompiled


### 10.3.3 - Shadow

* Avoid shadows
* Bake the shadows in the texture
* Optimize shadowMaps and mapSize with cameraHelpers
* Avoid CastShadow and ReceiveShadow when possible
* Deactivate shadow auto-update when we have static shadows

``` javascript
// Optimize shadowMap and mapSize
directionalLight.shadow.camera.top = 3
directionalLight.shadow.camera.right = 6
directionalLight.shadow.camera.left = - 6
directionalLight.shadow.camera.bottom = - 3
directionalLight.shadow.camera.far = 10
directionalLight.shadow.mapSize.set(1024, 1024)

const cameraHelper = new THREE.CameraHelper(directionalLight.shadow.camera)
scene.add(cameraHelper)

// Deactivate shadow auto-update
renderer.shadowMap.autoUpdate = false
renderer.shadowMap.needsUpdate = true
```


### 10.3.4 - Texture

* Small resolution as possible
* Use power of 2 resolutions: 256, 512, 1024
* Use files with the right format
* Reduce TinyPNG to reduce the weight of PNG or JPEG


### 10.3.5 - Material

* Use the same materials for different objects
* Avoid expensive materials like MeshStandardMaterial or MeshPhysicalMaterial


### 10.3.6 - Mesh

* Create one IntanceMesh and provide transformation matrix with Matrix4

``` javascript
const geometry = new THREE.BoxGeometry(0.5, 0.5, 0.5)

const material = new THREE.MeshNormalMaterial()

const mesh = new THREE.InstancedMesh(geometry, material, 50)
// Animate need dynamic matrix, activate this if needed in the tick()
mesh.instanceMatrix.setUsage(THREE.DynamicDrawUsage)
scene.add(mesh)

for(let i = 0; i < 50; i++)
{
    const position = new THREE.Vector3(
    (Math.random() - 0.5) * 10,
    (Math.random() - 0.5) * 10,
    (Math.random() - 0.5) * 10,
    )

    const quaternion = new THREE.Quaternion()
    quaternion.setFromEuler(new THREE.Euler(
    (Math.random() - 0.5) * Math.PI * 2,
    (Math.random() - 0.5) * Math.PI * 2
    ))

    const matrix = new THREE.Matrix4()
    matrix.makeRotationFromQuaternion(quaternion)
    matrix.setPosition(position)
    mesh.setMatrixAt(i, matrix)

    scene.add(mesh)
}
```

### 10.3.7 - Model

* When have alot of objects use Draco compression, freeze in the begining while decompress but its faster
* GZIP - Compression in the server side, for `.glb`, `.gltf`, `.obj`


### 10.3.8 - Camera

* Reduce the field of view, when we have something that we dont see and dont want to render
* Reduce near and far render the objects that we can see and are closer
* Use camera helpers

### 10.3.9 - Renderer

* Use the device pixel ratio function, don't use the default one
* Use this property in the rederer to reserve high-power

``` javascript
/**
 * Renderer
 */
const renderer = new THREE.WebGLRenderer({
    canvas: canvas,
    powerPreference: 'high-performance',
    antialias: true
})
```


### 10.3.10 - Post-processing

* Limit the passes, less is better
* 4 passes with pixel ratio 2 = 1920 * 2 * 1080 * 2 * 4 = 33177600 Pixels to renderer, less performant exponentially 

### 10.3.11 - Shader

* Reduce the precision of the shader
* Simplifies the mathematical algorithm as much as possible
* Use `clamp` instead of "if's"
* Don't mix the colors with the r, g,b use `mix()` function
* Avoid perling noise whenever possible, use similar textures alternatively
* Use Defines instead of uniforms when we have a satatic value
* Do the calculations in the vertex shader and use varying to send the fragment

``` javascript
const shaderGeometry = new THREE.PlaneGeometry(10, 10, 256, 256)

const shaderMaterial = new THREE.ShaderMaterial({
    uniforms:
    {
        defines:    // Alternative for defining static values
        {
            uDisplacementStrength: 0.5,
        },
        precision: 'lowp',  //
        uDisplacementTexture: { value: displacementTexture },
        uDisplacementStrength: { value: 1.5 }
    },
    vertexShader: `
        uniform sampler2D uDisplacementTexture;
        //uniform float uDisplacementStrength;
        #define uDisplacementStrength 1.5   // Static value

        varying vec2 vUv;
        varying vec3 vFinalColor;

        void main()
        {
            // Position
            vec4 modelPosition = modelMatrix * vec4(position, 1.0);

            float elevation = texture2D(uDisplacementTexture, uv).r;
            //if(elevation < 0.5)
            //{
            //    elevation = 0.5;
            //}
            modelPosition.y = clamp(elevation, 0.5, 1.0) * uDisplacementStrength;

            modelPosition.y += elevation * uDisplacementStrength;

            gl_Position = projectionMatrix * viewMatrix * modelPosition;

            // Color
            float colorElevation = max(elevation, 0.25);
            vec3 depthColor = vec3(1.0, 0.1, 0.1);
            vec3 surfaceColor = vec3(0.1, 0.0, 0.5);
            vec3 finalColor = mix(depthColor, surfaceColor, colorElevation);

            vUv = uv;
            vFinalColor = finalColor;
        }
    `,
    fragmentShader: `
        uniform sampler2D uDisplacementTexture;

        varying vec2 vUv;
        varying vec3 vFinalColor;

        void main()
        {
            //float elevation = texture2D(uDisplacementTexture, vUv).r;
            //if(elevation < 0.25)
            //{
            //    elevation = 0.25;
            //}

            //vec3 depthColor = vec3(1.0, 0.1, 0.1);
            //vec3 surfaceColor = vec3(0.1, 0.0, 0.5);
            //vec3 finalColor = vec3(0.0);
            //finalColor.r += depthColor.r + (surfaceColor.r - depthColor.r) * elevation;
            //finalColor.g += depthColor.g + (surfaceColor.g - depthColor.g) * elevation;
            //finalColor.b += depthColor.b + (surfaceColor.b - depthColor.b) * elevation;

            //vec3 finalColor = mix(depthColor, surfaceColor, elevation);

            gl_FragColor = vec4(vFinalColor, 1.0);
        }
    `
})

const shaderMesh = new THREE.Mesh(shaderGeometry, shaderMaterial)
shaderMesh.rotation.x = - Math.PI * 0.5
scene.add(shaderMesh)
```

## 10.4 - Loading and Intro

1. [Lower the download speed](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#1041---lower-the-download-speed)
2. [Implementation](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#1042---implementation)

Let's overlay an image on top and load a bar, when the resources are ready it will display the scene

### 10.4.1 - Lower the download speed

Browser -> Developer Tools -> Network
1. Disable cache
2. Whitout limitation -> add profile with 100000 speed (9.8mb/s) -> Choose that profile

### 10.4.2 - Implementation

``` javascript
import { gsap } from 'gsap'

/**
 * Loaders
 */
const loadingBarElement = document.querySelector('.loading-bar')

const loadingManager = new THREE.LoadingManager(
    () =>
    {
        // Last step dont have 0.5s transition so we give that with the timeout
        gsap.delayedCall(0.5, () => 
        {
            gsap.to(overlayMaterial.uniforms.uAlpha, { duration: 3, value: 0})
            
            // Add ended class
            loadingBarElement.classList.add('ended')
            loadingBarElement.style.transform = ''
        })
    },
    (itemUrl, itemsLoaded, itemsTotal) =>
    {
        const progressRatio = itemsLoaded / itemsTotal
        loadingBarElement.style.transform = `scaleX(${ progressRatio })`
        console.log(progressRatio)
    },
    () =>
    {
        console.log('Error loading the files!')
    }
)

const gltfLoader = new GLTFLoader(loadingManager)
const cubeTextureLoader = new THREE.CubeTextureLoader(loadingManager)

/**
 * Overlay
 */
const overlayGeometry = new THREE.PlaneGeometry(2, 2, 1, 1)
const overlayMaterial = new THREE.ShaderMaterial({
    uniforms:
    {
        uAlpha: { value : 1}
    },
    vertexShader: 
    `
        void main()
        {   
            gl_Position = vec4(position, 1.0);
        }
    `,
    fragmentShader:
    `
        uniform float uAlpha;

        void main()
            {   
                gl_FragColor = vec4(0.0, 0.0, 0.0, uAlpha);
            }
    `,
    //wireframe: true,
    transparent: true,
})
const overlay = new THREE.Mesh(overlayGeometry, overlayMaterial)

scene.add(overlay)
```

``` html
<body>
    <canvas class="webgl"></canvas>
    <div class="loading-bar"></div>
    <script type="module" src="./script.js"></script>
</body>
```

``` css
.loading-bar
{
    position: absolute;
    top: 50%;
    width: 100%;
    height: 2px;
    background: #ffffff;
    transform: scaleX(0);
    transform-origin: top left;
    transition: transform 0.5s;
    will-change: transform;
}

.loading-bar.ended
{
    transform: scaleX(0);
    transform-origin: top right;
    transition: transform 1.5s ease-in-out;
}
```

## 10.5 HTML and WebGL

Allows you to introduce points in space, for example to label the object, when you move the mouse over it a descriptive box will appear, when the point is behind the object it should not be visible

``` html
<body>
    
    <canvas class="webgl"></canvas>

    <div class="loading-bar"></div>

    <div class="point point-0">
        <div class="label">1</div>
        <div class="text">Front and top screen with HUD aggregating terrain and battle informations.</div>
    </div>
    <div class="point point-1">
        <div class="label">2</div>
        <div class="text">Ventilation with air purifier and detection of environment toxicity.</div>
    </div>
    <div class="point point-2">
        <div class="label">3</div>
        <div class="text">Cameras supporting night vision and heat vision with automatic adjustment.</div>
    </div>

    <script type="module" src="./script.js"></script>
</body>
```

``` css
.point
{
    position: absolute;
    top: 50%;
    left: 50%;
    font-family: Helvetica, Arial, sans-serif;
    color: #ffffff;
    font-weight: 100;
    font-size: 14px;
}

.point .label
{
    position: absolute;
    top: -20px;
    left: -20px;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: 1px solid #ffffff77;
    text-align: center;
    line-height: 40px;
    background: #00000077;
    cursor: help;
    transform: scale(0, 0);
    transition: transform 0.3s;
}

.point.visible .label{
    transform: scale(1, 1);
}

.point .label:hover
{
    background: #ce491477
}

.point .text
{
    position: absolute;
    top: 30px;
    left: -120px;
    width: 200px;
    padding: 20px;
    border-radius: 4px;
    border: 1px solid #ffffff77;
    background: #00000077;
    line-height: 1.3em;
    opacity: 0;
    transition: opacity 0.5s;
    pointer-events: none;
}

.point:hover .text{
    opacity: 1;
}
```

``` javascript
/**
 * Loaders
 */
let sceneReady = false
const loadingBarElement = document.querySelector('.loading-bar')
const loadingManager = new THREE.LoadingManager(
    // Loaded
    () =>
    {
        // (...)

        window.setTimeout(() =>
        {
            sceneReady = true
        }, 2000)
    },
    // (...)
)

/**
 * HTML Points of interest
 */
const raycaster = new THREE.Raycaster()

const points = [
    {
        position: new THREE.Vector3(1.55, 0.3, - 0.6),
        element: document.querySelector('.point-0')
    },
    {
        position: new THREE.Vector3(0.5, 0.8, - 1.6),
        element: document.querySelector('.point-1')
    },
    {
        position: new THREE.Vector3(1.6, - 1.3, - 0.7),
        element: document.querySelector('.point-2')
    }
]

/**
 * Animate
 */
const tick = () =>
{
    // Update controls
    controls.update()

    // Check if the scene is ready
    if(sceneReady)
    {
        // Show Points of interest in the 3D space
        for(const point of points)
        {
            // We use 2D perspective to see if the point is visible in the 3D model
            const screenPosition = point.position.clone()
            screenPosition.project(camera)

            // Check if the Point is behind the object
            raycaster.setFromCamera(screenPosition, camera)
            const intersectsObject = raycaster.intersectObjects(scene.children, true)
            if(intersectsObject.length === 0) {
                point.element.classList.add('visible')
            }
            else{
                const intersectionDistance = intersectsObject[0].distance
                // Check Point distance to the object
                const pointDistance = point.position.distanceTo(camera.position)
                
                if(intersectionDistance < pointDistance) {
                    point.element.classList.remove('visible')
                }
                else
                {
                    point.element.classList.add('visible')
                }
            }

            // Attach the point to the 3D model
            const translateX = screenPosition.x * sizes.width * 0.5
            const translateY = - screenPosition.y * sizes.height * 0.5
            point.element.style.transform = `translateX(${ translateX }px) translateY(${ translateY }px)`
        }
    }

    // (...)
}

tick()
```

------

# 11 - UV unwrapping

1. [Wrap](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#111---wrap)
2. [Export](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced#112---export)

`Blender`


## 11.1 - Wrap

1. Disjoint all objects with `F3` -> make single object and data
We can do this individually after selecting the object with `P`

2. Before doing uv unwrapping or exporting the model we must see if the textures are correctly turned, otherwise we have to flip them.

3. Top right corner, two balls, enable `Face Orientation` filter.

4. Next we must select everything, control A and stabilize the scale, only now can we start unwrapping:
* `A` + `A` -> `Scale`

6. When unwrapping we can say where we are going to start opening the geometry with:
* `U` -> `Mark Seam`

7. To move the unwrapp on the island we can select any part of the object, press `Control` + `L`, and now we can organize the geometry in the wrap

8. After unwrapping everything, it is better to separate each object to improve mipmaping, add margin after unwrapping

9. Apply filmic filter to the Baked image, change the view mode to Compositor, click on use nodes, add `Image` node and `Denoise`, mute the `Render layers` with the `M`


## 11.2 - Export

Export the Model after selecting all except the camera and the lights:

1. Go to file
2. glTF Binary
3. Selected Objects
4. +Y Up
5. UVs
6. No export Materials
7. compression
8. Disable Animation
9. Shape Keys and Skinning
